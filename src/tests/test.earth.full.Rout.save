> # test.earth.full.R: test earth
> 
> library(earth)
Loading required package: leaps
> library(mda)
Loading required package: class
> data(ozone1)
> data(trees)
> 
> print.time <- FALSE         # FALSE for no time results (for diff against reference)
> plot.it.default <- TRUE     # TRUE to do plots too, FALSE for speed
> options.old <- options()
> options(digits = 2)
> 
> #--- test examples from man pages ------------------------------------------------------------
> 
> cat("--- earth.Rd ----------------------\n")
--- earth.Rd ----------------------
> a <- earth(Volume ~ ., data = trees)
> print(summary(a, digits = 2))
Call:
earth(formula = Volume ~ ., data = trees)

Expression:
  23 
  +  5.7 * pmax(0,  Girth -     13) 
  -  2.9 * pmax(0,     13 -  Girth) 
  + 0.72 * pmax(0, Height -     76) 

Number of cases: 31
Selected 4 of 5 terms, and 2 of 2 predictors
Number of terms at each degree of interaction: 1 3 (additive model)
GCV: 11     RSS: 213     GRSq: 0.96     RSq: 0.97 
> 
> set.seed(1)
> train.subset <- rep(FALSE, nrow(trees))
> train.subset[sample(1:nrow(trees), .8 * nrow(trees))] <- TRUE
> test.subset <- !train.subset
> a <- earth(Volume~., data=trees[train.subset, ])
> yhat <- predict(a, newdata=trees[test.subset, ])
> y <- trees[test.subset, "Volume"]
> rsq <- 1 - sum((y - yhat)^2)/sum((y - mean(y))^2)
> print(rsq, digits=2)
[1] 0.95
> 
> cat("--- format.earth.Rd ----------------------\n")
--- format.earth.Rd ----------------------
> as.func <- function( # convert expression string to func
+                object, digits = 8, use.names = TRUE, ...)
+   eval(parse(text=paste(
+     "function(x)\n",
+     "{\n",
+     "if(is.vector(x))\n",
+     "  x <- matrix(x, nrow = 1, ncol = length(x))\n",
+     "with(as.data.frame(x),\n",
+     format(object, digits = digits, use.names = use.names, ...),
+     ")\n",
+     "}\n", sep = "")))
> a <- earth(Volume ~ ., data = trees)
> my.func <- as.func(a, use.names = FALSE)
> print(my.func(c(10,80)))     # yields 17.76888
[1] 18
> print(predict(a, c(10,80)))  # yields 17.76888, but is slower
[1] 18
> a <- earth(Volume ~ ., data = trees)
> cat(format(a))
  23 
  +  5.7 * pmax(0,  Girth -     13) 
  -  2.9 * pmax(0,     13 -  Girth) 
  + 0.72 * pmax(0, Height -     76) 
> cat(format(a, use.names = FALSE, add.labels = TRUE))
  23  # 1
  +  5.7 * pmax(0, x[,1] -    13)  # 2
  -  2.9 * pmax(0,    13 - x[,1])  # 3
  + 0.72 * pmax(0, x[,2] -    76)  # 4
> cat("--- get.nterms.per.degree.Rd ----------------------\n")
--- get.nterms.per.degree.Rd ----------------------
> a <- earth(O3 ~ ., data = ozone1, degree = 2)
> print(get.nterms.per.degree(a))

0 1 2 
1 5 5 
> cat("--- get.nused.preds.per.subset.Rd ----------------------\n")
--- get.nused.preds.per.subset.Rd ----------------------
> a <- earth(O3 ~ ., data = ozone1, degree = 2)
> print(get.nused.preds.per.subset(a$dirs, a$selected.terms))
[1] 8
> print(get.nused.preds.per.subset(a$dirs, a$prune.terms))
 [1] 0 1 2 3 4 4 5 6 7 7 8 8 8 8 8 8 8 8 8 8 8
> cat("--- mars.to.earth.Rd ----------------------\n")
--- mars.to.earth.Rd ----------------------
> a <- mars(trees[,-3], trees[,3])
> a <- mars.to.earth(a)
> print(summary(a, digits = 2))
Call:
earth(x = trees[, -3], y = trees[, 3])

Expression:
  20 
  +  5.4 * pmax(0,  Girth -     12) 
  -  2.6 * pmax(0,     12 -  Girth) 
  + 0.72 * pmax(0, Height -     76) 

Number of cases: 31
Selected 4 of 5 terms, and 2 of 2 predictors
Number of terms at each degree of interaction: 1 3 (additive model)
GCV: 13     RSS: 251     GRSq: 0.95     RSq: 0.97 
> cat("--- model.matrix.Rd ----------------------\n")
--- model.matrix.Rd ----------------------
> a <- earth(Volume ~ ., data = trees)
> print(summary(a, decomp = "none"))
Call:
earth(formula = Volume ~ ., data = trees)

Expression:
  23 
  +  5.7 * pmax(0,  Girth -     13) 
  -  2.9 * pmax(0,     13 -  Girth) 
  + 0.72 * pmax(0, Height -     76) 

Number of cases: 31
Selected 4 of 5 terms, and 2 of 2 predictors
Number of terms at each degree of interaction: 1 3 (additive model)
GCV: 11     RSS: 213     GRSq: 0.96     RSq: 0.97 
> bx <- model.matrix(a)
> a.lm <- lm(trees$Volume ~ bx[,-1])
> print(summary(a.lm))

Call:
lm(formula = trees$Volume ~ bx[, -1])

Residuals:
    Min      1Q  Median      3Q     Max 
-5.2900 -1.9782  0.0712  1.9209  4.1267 

Coefficients:
                      Estimate Std. Error t value Pr(>|t|)    
(Intercept)             23.208      0.997   23.28  < 2e-16 ***
bx[, -1]h(Girth-12.9)    5.746      0.297   19.35  < 2e-16 ***
bx[, -1]h(12.9-Girth)   -2.866      0.444   -6.45  6.5e-07 ***
bx[, -1]h(Height-76)     0.718      0.175    4.10  0.00034 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Residual standard error: 2.8 on 27 degrees of freedom
Multiple R-Squared: 0.974,	Adjusted R-squared: 0.971 
F-statistic:  333 on 3 and 27 DF,  p-value: <2e-16 

> cat("--- plot.earth.models.Rd ----------------------\n")
--- plot.earth.models.Rd ----------------------
> a1 <- earth(O3 ~ ., data = ozone1, degree = 2)
> a2 <- earth(O3 ~ .-wind, data = ozone1, degree = 2, nk = 31)
> a3 <- earth(O3 ~ .-humidity, data = ozone1, degree = 2, nk = 31)
> plot.earth.models(list(a1,a2,a3), rlim=c(.6,.8), cum.grid="n")
> cat("--- plot.earth.Rd ----------------------\n")
--- plot.earth.Rd ----------------------
> a <- earth(O3 ~ ., data = ozone1, degree = 2)
> plot(a, col.npreds = 1, cum.grid = "none")
> cat("--- predict.earth.Rd ----------------------\n")
--- predict.earth.Rd ----------------------
> a <- earth(Volume ~ ., data = trees)
> predict(a)
 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 
10 11 11 16 20 22 18 18 21 18 21 19 19 20 21 23 30 33 28 28 31 34 32 41 43 52 
27 28 29 30 31 
54 55 55 55 75 
> predict(a, c(10,80))
[1] 18
> cat("--- reorder.earth.Rd ----------------------\n")
--- reorder.earth.Rd ----------------------
> a <- earth(O3 ~ ., data = ozone1, degree = 2)
> print(reorder(a, decomp = "none"))
 [1]  1  2  3  4  5  6  7  8  9 10 11
> print(a$selected.terms[reorder(a)])
 [1]  1  2 19 13  6  7 14  9 10 11 17
> cat("--- update.earth.Rd ----------------------\n")
--- update.earth.Rd ----------------------
> a <- earth(Volume~ ., data = trees)
> print(summary(a, digits = 2))
Call:
earth(formula = Volume ~ ., data = trees)

Expression:
  23 
  +  5.7 * pmax(0,  Girth -     13) 
  -  2.9 * pmax(0,     13 -  Girth) 
  + 0.72 * pmax(0, Height -     76) 

Number of cases: 31
Selected 4 of 5 terms, and 2 of 2 predictors
Number of terms at each degree of interaction: 1 3 (additive model)
GCV: 11     RSS: 213     GRSq: 0.96     RSq: 0.97 
> a <- earth(O3 ~ ., data = ozone1, degree = 2)
> print(summary(update(a, formula = O3 ~ . - temp)))
Call:
earth(formula = O3 ~ vh + wind + humidity + ibh + dpg + ibt + 
    vis + doy, data = ozone1, degree = 2)

Expression:
  13 
  +    0.17 * pmax(0,       vh -     5890) 
  -   0.048 * pmax(0,      dpg -       13) 
  +    0.13 * pmax(0,      ibt -      111) 
  -    0.04 * pmax(0,      doy -      125) 
  -   0.084 * pmax(0,      125 -      doy) 
  - 4.4e-06 * pmax(0,     5890 -       vh) * pmax(0,      ibh -     1899) 
  - 1.5e-05 * pmax(0,     5890 -       vh) * pmax(0,     1899 -      ibh) 
  -   0.031 * pmax(0,     wind -        7) * pmax(0,      ibt -      111) 
  -  0.0021 * pmax(0,       58 - humidity) * pmax(0,      ibt -      111) 
  -  0.0016 * pmax(0,      dpg -       43) * pmax(0,      ibt -      111) 
  - 0.00043 * pmax(0,       43 -      dpg) * pmax(0,      ibt -      111) 
  - 0.00013 * pmax(0,      ibt -      111) * pmax(0,      vis -       40) 
  - 0.00086 * pmax(0,      ibt -      250) * pmax(0,      doy -      125) 
  + 8.4e-05 * pmax(0,      250 -      ibt) * pmax(0,      doy -      125) 

Number of cases: 330
Selected 15 of 21 terms, and 8 of 8 predictors
Number of terms at each degree of interaction: 1 5 9
GCV: 13     RSS: 3443     GRSq: 0.8     RSq: 0.84 
> print(summary(update(a, nprune = 8)))
Call:
earth(formula = O3 ~ ., data = ozone1, degree = 2, nprune = 8, 
    Object = a)

Expression:
  13 
  +   0.33 * pmax(0,     temp -       58) 
  -  0.037 * pmax(0,      234 -      ibt) 
  +  0.017 * pmax(0,      200 -      vis) 
  -  0.021 * pmax(0,      doy -       92) 
  -   0.13 * pmax(0,       92 -      doy) 
  -  0.024 * pmax(0,       55 - humidity) * pmax(0,     temp -       58) 
  + 0.0046 * pmax(0,     temp -       58) * pmax(0,       54 -      dpg) 

Number of cases: 330
Selected 8 of 21 terms, and 6 of 9 predictors
Number of terms at each degree of interaction: 1 5 2
GCV: 15     RSS: 4434     GRSq: 0.77     RSq: 0.79 
> 
> #--- test model building capabilities --------------------------------------------------------
> 
> cat("--- test model building capabilities ----------------------\n")
--- test model building capabilities ----------------------
> itest <- 0
> N <- 100
> set.seed(1)
> x1 <- runif(N, -1, 1)
> x2 <- runif(N, -1, 1)
> x3 <- runif(N, -1, 1)
> x4 <- runif(N, -1, 1)
> x5 <- runif(N, -1, 1)
> x6 <- runif(N, -1, 1)
> x7 <- runif(N, -1, 1)
> x8 <- runif(N, -1, 1)
> x9 <- runif(N, -1, 1)
> x10 <- runif(N, -1, 1)
> 
> make.func <- function(
+     obj      = stop("no 'obj' arg"),
+     digits   = 14,
+     use.names = TRUE,   # use predictor names, else "x[,1]" etc
+     ...)                # extra args passed onto format, eg add.labels=TRUE
+ {
+     s <- paste(
+         "function(x)\n",
+         "{\n",
+         "if(is.vector(x))\n",
+         "  x <- matrix(x, nrow=1, ncol=length(x))\n",
+         "with(as.data.frame(x),\n",
+         format(obj, digits=digits, use.names=use.names, ...),
+         ")\n",
+         "}\n", sep="")
+ 
+     eval.parent(parse(text=s))
+ }
> 
> # this cross checks that RSq and GRSq claimed by 
> # the model versus an independent calc of RSq and GRSq
> 
> test.model.rsq <- function(object, x, y, MarsFunc, nCases, nUsedTerms, penalty, RefFunc=NULL, ...)
+ {
+     y1 <- RefFunc(x, ...)
+     rss <- sum((y1 - MarsFunc(x))^2)
+     rss.null <- sum((y - mean(y))^2)
+     gcv.null <- earth:::get.gcv(rss.null, 1, 0, penalty, nCases)
+     gcv <- earth:::get.gcv(rss, nUsedTerms, (nUsedTerms-1)/2, penalty, nCases)
+     # $$ these happen, look into it
+     if(is.finite(object$rsq))
+         if(!isTRUE(all.equal(object$rsq, 1 - rss/rss.null)))
+             cat("\nWarning: RSq mismatch object$rsq", object$rsq, "calculated RSq", 1 - rss/rss.null)
+         else if(!isTRUE(all.equal(object$grsq, 1 - gcv/gcv.null)))
+             cat("\nWarning GRSq mismatch object$grsq", object$grsq, "calculated GRSq", 1 - gcv/gcv.null)
+ }
> 
> # this uses the global x and d
> test.earth <- function(itest, func, degree=2, nk=51, plotit=plot.it.default, test.rsq=TRUE, trace=0)
+ {
+     cat(sprintf("%-3d", itest), sprintf("%-32s", deparse(substitute(func))), 
+         "degree", sprintf("%-2d", degree), "nk", sprintf("%-3g", nk))
+     gc()
+     earthTime <- system.time(fite <- earth(d[,-1, drop=FALSE], d[,1], degree=degree,
+                                            trace=trace, nk=nk, pmethod="b", fast.k=-1))
+     funca <- make.func(fite)
+     nCases <- nrow(x)
+     penalty <- ifelse(degree>1,3,2)
+     nUsedTerms <- sum(fite$selected.terms!=0)
+     cat(" nTerms",  sprintf("%-2d", nUsedTerms), "of", sprintf("%-3d ", ncol(fite$bx)))
+     if(print.time)
+         cat(" time", earthTime[1])
+     cat("GRSq", sprintf("%4.2g", fite$grsq))
+     sub.caption <- paste(itest, ": ", deparse(substitute(func)), " degree=", degree, " nk=", nk, sep="")
+     if(test.rsq)
+     test.model.rsq(fite, x=x, y=d[,1], MarsFunc=funca, nCases=nCases,
+                    nUsedTerms=nUsedTerms, penalty=penalty, RefFunc=func)
+     if(plotit) {
+         plotmo(fite, func=func, sub.caption=sub.caption)
+         plot(fite, nresiduals=500, sub.caption=sub.caption)
+     }
+     cat("\n")
+     fite
+ }
> 
> ozone.test <- function(itest, sModel, x, y, degree=2, nk=51,
+                     plotit=plot.it.default, trace=0, col.loess="lightblue")
+ {
+     fite <- earth(x, y, degree=degree, nk=nk, trace=trace)
+     fitm <- mars(x, y, degree=degree, nk=nk)
+ 
+     cat(sprintf("%-3d", itest),
+         sprintf("%-32s", sModel), 
+         "degree", sprintf("%-2d", degree), "nk", sprintf("%-3g", nk),
+         "nTerms",  sprintf("%-2d", sum(fite$selected.terms != 0)), 
+         "of", sprintf("%-3d", sum(fite$selected.terms)),
+         "GRSq", sprintf("%4.2g", fite$grsq),
+         "GRSq ratio", fite$grsq/mars.to.earth(fitm)$grsq,
+         "\n")
+     sub.caption <- paste(itest, ": ", sModel, " degree=", degree, " nk=", nk, sep="")
+     if(plotit) {
+         fitme <- mars.to.earth(fitm)
+         plotmo(fite, sub.caption=paste("EARTH", sub.caption))
+         plotmo(fitme, sub.caption=paste("MARS", sub.caption))
+         plot(fite, nresiduals=500, col.loess=col.loess, sub.caption=paste("EARTH", sub.caption))
+         plot(fitme, sub.caption=paste("MARS", sub.caption))
+         fitme <- update(fitme)  # generate model selection data
+         plot.earth.models(list(fite, fitme), sub.caption=paste(itest, ": Compare earth to mars ", sModel, sep=""))
+     }
+     fite
+ }
> 
> funcNoise <- function(x)    # noise
+ {
+     rnorm(1)
+ }
> x <- cbind(              x1)
> d <- cbind(funcNoise(x), x1)
> # plotit=FALSE because there is only an intercept
> itest <- itest+1; test.earth(itest, funcNoise, nk=5,  degree=1, plotit=FALSE, test.rsq=FALSE)
1   funcNoise                        degree 1  nk 5   nTerms 1  of 1   GRSq  NaN
Selected 1 of 3 terms, and 0 of 1 predictors
Number of terms at each degree of interaction: 1 (intercept only model)
GCV: 0     RSS: 0     GRSq: NaN     RSq: NaN 
> itest <- itest+1; test.earth(itest, funcNoise, nk=5,  degree=2, plotit=FALSE, test.rsq=FALSE)
2   funcNoise                        degree 2  nk 5   nTerms 1  of 1   GRSq  NaN
Selected 1 of 3 terms, and 0 of 1 predictors
Number of terms at each degree of interaction: 1 (intercept only model)
GCV: 0     RSS: 0     GRSq: NaN     RSq: NaN 
> itest <- itest+1; test.earth(itest, funcNoise, nk=51, degree=1, plotit=FALSE, test.rsq=FALSE)
3   funcNoise                        degree 1  nk 51  nTerms 1  of 1   GRSq  NaN
Selected 1 of 3 terms, and 0 of 1 predictors
Number of terms at each degree of interaction: 1 (intercept only model)
GCV: 0     RSS: 0     GRSq: NaN     RSq: NaN 
> itest <- itest+1; test.earth(itest, funcNoise, nk=51, degree=2, plotit=FALSE, test.rsq=FALSE)
4   funcNoise                        degree 2  nk 51  nTerms 1  of 1   GRSq  NaN
Selected 1 of 3 terms, and 0 of 1 predictors
Number of terms at each degree of interaction: 1 (intercept only model)
GCV: 0     RSS: 0     GRSq: NaN     RSq: NaN 
> 
> func1 <- function(x)
+ {
+     sin(3 * x[,1]) + x[,2]
+ }
> x <- cbind(          x1, x2)
> d <- cbind(func1(x), x1, x2)
> itest <- itest+1; test.earth(itest, func1, nk=5,   degree=1)
5   func1                            degree 1  nk 5   nTerms 4  of 4   GRSq 0.86
Selected 4 of 5 terms, and 2 of 2 predictors
Number of terms at each degree of interaction: 1 3 (additive model)
GCV: 0.12     RSS: 10     GRSq: 0.86     RSq: 0.88 
> itest <- itest+1; test.earth(itest, func1, nk=5,   degree=2)
6   func1                            degree 2  nk 5   nTerms 4  of 4   GRSq 0.86
Selected 4 of 5 terms, and 2 of 2 predictors
Number of terms at each degree of interaction: 1 3 (additive model)
GCV: 0.12     RSS: 10     GRSq: 0.86     RSq: 0.88 
> itest <- itest+1; test.earth(itest, func1, nk=51, degree=1)
7   func1                            degree 1  nk 51  nTerms 8  of 8   GRSq    1
Selected 8 of 8 terms, and 2 of 2 predictors
Number of terms at each degree of interaction: 1 7 (additive model)
GCV: 0.0025     RSS: 0.18     GRSq: 1     RSq: 1 
> itest <- itest+1; test.earth(itest, func1, nk=51, degree=2)
8   func1                            degree 2  nk 51  nTerms 8  of 8   GRSq    1
Selected 8 of 8 terms, and 2 of 2 predictors
Number of terms at each degree of interaction: 1 7 (additive model)
GCV: 0.0027     RSS: 0.18     GRSq: 1     RSq: 1 
> 
> func7 <- function(x)    # just one predictor
+ {
+     sin(5 * x[,1])
+ }
> x <- cbind(x1)
> d <- cbind(func7(x), x1)
> itest <- itest+1; a<-test.earth(itest, func7, nk=5, degree=1)
9   func7                            degree 1  nk 5   nTerms 4  of 4   GRSq 0.76
> itest <- itest+1; test.earth(itest, func7, nk=5,   degree=2)
10  func7                            degree 2  nk 5   nTerms 4  of 4   GRSq 0.75
Selected 4 of 4 terms, and 1 of 1 predictors
Number of terms at each degree of interaction: 1 3 (additive model)
GCV: 0.13     RSS: 11     GRSq: 0.75     RSq: 0.79 
> itest <- itest+1; test.earth(itest, func7, nk=51, degree=1)
11  func7                            degree 1  nk 51  nTerms 6  of 6   GRSq 0.97
Selected 6 of 7 terms, and 1 of 1 predictors
Number of terms at each degree of interaction: 1 5 (additive model)
GCV: 0.017     RSS: 1.3     GRSq: 0.97     RSq: 0.97 
> itest <- itest+1; test.earth(itest, func7, nk=51, degree=2)
12  func7                            degree 2  nk 51  nTerms 6  of 6   GRSq 0.97
Selected 6 of 7 terms, and 1 of 1 predictors
Number of terms at each degree of interaction: 1 5 (additive model)
GCV: 0.018     RSS: 1.3     GRSq: 0.97     RSq: 0.97 
> 
> func8 <- function(x)
+ {
+     ret <- 0
+     for (i in 1:5)
+         ret <- ret + sin(2 * x[,i])
+     ret + x[,1]*cos(4 * x[,2]) + (x[,3]-2)* x[,4]
+ }
> 
> func8noise <- function(x)
+ {
+     func8(x) + rnorm(nrow(x),0,1)
+ }
> 
> x <- cbind(          x1,  x2,  x3,  x4,  x5)
> d <- cbind(func8(x), x1,  x2,  x3,  x4,  x5)
> itest <- itest+1; test.earth(itest, func8, nk=11, degree=1)
13  func8                            degree 1  nk 11  nTerms 11 of 11  GRSq 0.89
Selected 11 of 11 terms, and 5 of 5 predictors
Number of terms at each degree of interaction: 1 10 (additive model)
GCV: 0.31     RSS: 19     GRSq: 0.9     RSq: 0.93 
> itest <- itest+1; test.earth(itest, func8, nk=11, degree=2)
14  func8                            degree 2  nk 11  nTerms 11 of 11  GRSq 0.88
Selected 11 of 11 terms, and 5 of 5 predictors
Number of terms at each degree of interaction: 1 10 (additive model)
GCV: 0.35     RSS: 19     GRSq: 0.88     RSq: 0.93 
> itest <- itest+1; test.earth(itest, func8, nk=11, degree=10)
15  func8                            degree 10 nk 11  nTerms 11 of 11  GRSq 0.88
Selected 11 of 11 terms, and 5 of 5 predictors
Number of terms at each degree of interaction: 1 10 (additive model)
GCV: 0.35     RSS: 19     GRSq: 0.88     RSq: 0.93 
> itest <- itest+1; test.earth(itest, func8, nk=51, degree=1)
16  func8                            degree 1  nk 51  nTerms 14 of 14  GRSq 0.91
Selected 14 of 18 terms, and 5 of 5 predictors
Number of terms at each degree of interaction: 1 13 (additive model)
GCV: 0.27     RSS: 14     GRSq: 0.9     RSq: 0.95 
> itest <- itest+1; test.earth(itest, func8, nk=51, degree=2)
17  func8                            degree 2  nk 51  nTerms 20 of 20  GRSq 0.98
Selected 20 of 23 terms, and 5 of 5 predictors
Number of terms at each degree of interaction: 1 14 5
GCV: 0.054     RSS: 1.4     GRSq: 0.98     RSq: 1 
> itest <- itest+1; test.earth(itest, func8, nk=51, degree=10)
18  func8                            degree 10 nk 51  nTerms 20 of 20  GRSq 0.98
Selected 20 of 23 terms, and 5 of 5 predictors
Number of terms at each degree of interaction: 1 14 5
GCV: 0.054     RSS: 1.4     GRSq: 0.98     RSq: 1 
> itest <- itest+1; test.earth(itest, func8noise, nk=11, degree=1,  test.rsq=FALSE)
19  func8noise                       degree 1  nk 11  nTerms 11 of 11  GRSq 0.89
Selected 11 of 11 terms, and 5 of 5 predictors
Number of terms at each degree of interaction: 1 10 (additive model)
GCV: 0.31     RSS: 19     GRSq: 0.9     RSq: 0.93 
> itest <- itest+1; test.earth(itest, func8noise, nk=11, degree=2,  test.rsq=FALSE)
20  func8noise                       degree 2  nk 11  nTerms 11 of 11  GRSq 0.88
Selected 11 of 11 terms, and 5 of 5 predictors
Number of terms at each degree of interaction: 1 10 (additive model)
GCV: 0.35     RSS: 19     GRSq: 0.88     RSq: 0.93 
> itest <- itest+1; test.earth(itest, func8noise, nk=11, degree=10, test.rsq=FALSE)
21  func8noise                       degree 10 nk 11  nTerms 11 of 11  GRSq 0.88
Selected 11 of 11 terms, and 5 of 5 predictors
Number of terms at each degree of interaction: 1 10 (additive model)
GCV: 0.35     RSS: 19     GRSq: 0.88     RSq: 0.93 
> itest <- itest+1; test.earth(itest, func8noise, nk=51, degree=1,  test.rsq=FALSE)
22  func8noise                       degree 1  nk 51  nTerms 14 of 14  GRSq 0.91
Selected 14 of 18 terms, and 5 of 5 predictors
Number of terms at each degree of interaction: 1 13 (additive model)
GCV: 0.27     RSS: 14     GRSq: 0.9     RSq: 0.95 
> itest <- itest+1; test.earth(itest, func8noise, nk=51, degree=2,  test.rsq=FALSE)
23  func8noise                       degree 2  nk 51  nTerms 20 of 20  GRSq 0.98
Selected 20 of 23 terms, and 5 of 5 predictors
Number of terms at each degree of interaction: 1 14 5
GCV: 0.054     RSS: 1.4     GRSq: 0.98     RSq: 1 
> itest <- itest+1; test.earth(itest, func8noise, nk=51, degree=10, test.rsq=FALSE)
24  func8noise                       degree 10 nk 51  nTerms 20 of 20  GRSq 0.98
Selected 20 of 23 terms, and 5 of 5 predictors
Number of terms at each degree of interaction: 1 14 5
GCV: 0.054     RSS: 1.4     GRSq: 0.98     RSq: 1 
> 
> eqn56 <- function(x) # Friedman MARS paper equation 56
+ {
+     0.1 * exp(4*x[,1]) +
+     4 / (1 + exp(-20*(x[,2]-0.5))) +
+     3 * x[,3] +
+     2 * x[,4] +
+     x[,5]
+ }
> 
> eqn56noise <- function(x)
+ {
+     eqn56(x) + rnorm(nrow(x),0,1)
+ }
> 
> x <- cbind(          x1, x2, x3, x4, x5, x6, x7, x8, x9, x10 )
> d <- cbind(eqn56(x), x1, x2, x3, x4, x5, x6, x7, x8, x9, x10 )
> itest <- itest+1; test.earth(itest, eqn56, nk=11, degree=1)
25  eqn56                            degree 1  nk 11  nTerms 10 of 10  GRSq 0.96
Selected 10 of 11 terms, and 5 of 10 predictors
Number of terms at each degree of interaction: 1 9 (additive model)
GCV: 0.34     RSS: 22     GRSq: 0.96     RSq: 0.97 
> itest <- itest+1; test.earth(itest, eqn56, nk=11, degree=2)
26  eqn56                            degree 2  nk 11  nTerms 10 of 10  GRSq 0.96
Selected 10 of 11 terms, and 5 of 10 predictors
Number of terms at each degree of interaction: 1 9 (additive model)
GCV: 0.38     RSS: 22     GRSq: 0.96     RSq: 0.97 
> itest <- itest+1; test.earth(itest, eqn56, nk=11, degree=10)
27  eqn56                            degree 10 nk 11  nTerms 10 of 10  GRSq 0.96
Selected 10 of 11 terms, and 5 of 10 predictors
Number of terms at each degree of interaction: 1 9 (additive model)
GCV: 0.38     RSS: 22     GRSq: 0.96     RSq: 0.97 
> itest <- itest+1; test.earth(itest, eqn56, nk=51, degree=1)
28  eqn56                            degree 1  nk 51  nTerms 13 of 13  GRSq    1
Selected 13 of 14 terms, and 5 of 10 predictors
Number of terms at each degree of interaction: 1 12 (additive model)
GCV: 0.035     RSS: 2.0     GRSq: 1     RSq: 1 
> itest <- itest+1; test.earth(itest, eqn56, nk=51, degree=2)
29  eqn56                            degree 2  nk 51  nTerms 13 of 13  GRSq    1
Selected 13 of 14 terms, and 5 of 10 predictors
Number of terms at each degree of interaction: 1 12 (additive model)
GCV: 0.041     RSS: 2.0     GRSq: 1     RSq: 1 
> itest <- itest+1; test.earth(itest, eqn56, nk=51, degree=10)
30  eqn56                            degree 10 nk 51  nTerms 13 of 13  GRSq    1
Selected 13 of 14 terms, and 5 of 10 predictors
Number of terms at each degree of interaction: 1 12 (additive model)
GCV: 0.041     RSS: 2.0     GRSq: 1     RSq: 1 
> itest <- itest+1; test.earth(itest, eqn56noise, nk=11, degree=1,  test.rsq=FALSE)
31  eqn56noise                       degree 1  nk 11  nTerms 10 of 10  GRSq 0.96
Selected 10 of 11 terms, and 5 of 10 predictors
Number of terms at each degree of interaction: 1 9 (additive model)
GCV: 0.34     RSS: 22     GRSq: 0.96     RSq: 0.97 
> itest <- itest+1; test.earth(itest, eqn56noise, nk=11, degree=2,  test.rsq=FALSE)
32  eqn56noise                       degree 2  nk 11  nTerms 10 of 10  GRSq 0.96
Selected 10 of 11 terms, and 5 of 10 predictors
Number of terms at each degree of interaction: 1 9 (additive model)
GCV: 0.38     RSS: 22     GRSq: 0.96     RSq: 0.97 
> itest <- itest+1; test.earth(itest, eqn56noise, nk=11, degree=10, test.rsq=FALSE)
33  eqn56noise                       degree 10 nk 11  nTerms 10 of 10  GRSq 0.96
Selected 10 of 11 terms, and 5 of 10 predictors
Number of terms at each degree of interaction: 1 9 (additive model)
GCV: 0.38     RSS: 22     GRSq: 0.96     RSq: 0.97 
> itest <- itest+1; test.earth(itest, eqn56noise, nk=51, degree=1,  test.rsq=FALSE)
34  eqn56noise                       degree 1  nk 51  nTerms 13 of 13  GRSq    1
Selected 13 of 14 terms, and 5 of 10 predictors
Number of terms at each degree of interaction: 1 12 (additive model)
GCV: 0.035     RSS: 2.0     GRSq: 1     RSq: 1 
> itest <- itest+1; test.earth(itest, eqn56noise, nk=51, degree=2,  test.rsq=FALSE)
35  eqn56noise                       degree 2  nk 51  nTerms 13 of 13  GRSq    1
Selected 13 of 14 terms, and 5 of 10 predictors
Number of terms at each degree of interaction: 1 12 (additive model)
GCV: 0.041     RSS: 2.0     GRSq: 1     RSq: 1 
> itest <- itest+1; test.earth(itest, eqn56noise, nk=51, degree=10, test.rsq=FALSE)
36  eqn56noise                       degree 10 nk 51  nTerms 13 of 13  GRSq    1
Selected 13 of 14 terms, and 5 of 10 predictors
Number of terms at each degree of interaction: 1 12 (additive model)
GCV: 0.041     RSS: 2.0     GRSq: 1     RSq: 1 
> 
> robotArm <- function(x) # Friedman Fast MARS paper
+ {
+     l1     <- x[,1]
+     l2     <- x[,2]
+     theta1 <- x[,3]
+     theta2 <- x[,4]
+     phi    <- x[,5]
+ 
+     x1 <- l1 * cos(theta1) - l2 * cos(theta1 + theta2) * cos(phi)
+     y <-  l1 * sin(theta1) - l2 * sin(theta1 + theta2) * cos(phi)
+     z <-  l2 *  sin(theta2) * sin(phi)
+ 
+     sqrt(x1^2 + y^2 + z^2)
+ }
> N1 <- 100
> set.seed(1)
> x1. <- runif(N1, -1, 1)
> x2. <- runif(N1, -1, 1)
> x3. <- runif(N1, -1, 1)
> x4. <- runif(N1, -1, 1)
> x5. <- runif(N1, -1, 1)
> 
> x <- cbind(             (x1.+1)/2, (x2.+2)/2, pi*(x3.+1), pi*(x4.+1), pi*x5./2 )
> d <- cbind(robotArm(x), (x1.+1)/2, (x2.+2)/2, pi*(x3.+1), pi*(x4.+1), pi*x5./2 )
> colnames(x) <- c("l1", "l2", "theta1", "theta2", "phi")
> colnames(d) <- c("arm", "l1", "l2", "theta1", "theta2", "phi")
> itest <- itest+1; test.earth(itest, robotArm, nk=51, degree=1)
37  robotArm                         degree 1  nk 51  nTerms 10 of 10  GRSq 0.79
Selected 10 of 17 terms, and 4 of 5 predictors
Number of terms at each degree of interaction: 1 9 (additive model)
GCV: 0.038     RSS: 2.5     GRSq: 0.8     RSq: 0.86 
> itest <- itest+1; test.earth(itest, robotArm, nk=51, degree=10)
38  robotArm                         degree 10 nk 51  nTerms 19 of 19  GRSq 0.85
Selected 19 of 38 terms, and 4 of 5 predictors
Number of terms at each degree of interaction: 1 10 8
GCV: 0.028     RSS: 0.82     GRSq: 0.85     RSq: 0.96 
> itest <- itest+1; test.earth(itest, robotArm, nk=201, degree=1)
39  robotArm                         degree 1  nk 201 nTerms 10 of 10  GRSq 0.79
Selected 10 of 17 terms, and 4 of 5 predictors
Number of terms at each degree of interaction: 1 9 (additive model)
GCV: 0.038     RSS: 2.5     GRSq: 0.8     RSq: 0.86 
> itest <- itest+1; test.earth(itest, robotArm, nk=201, degree=10)
40  robotArm                         degree 10 nk 201 nTerms 19 of 19  GRSq 0.85
Selected 19 of 38 terms, and 4 of 5 predictors
Number of terms at each degree of interaction: 1 10 8
GCV: 0.028     RSS: 0.82     GRSq: 0.85     RSq: 0.96 
> 
> # tests with ozone data
> 
> data(ozone1)
> attach(ozone1)
> 
> x <- cbind(wind, humidity, temp, vis)
> y <- doy
> itest <- itest+1; ozone.test(itest, "doy ~ wind+humidity+temp+vis", x, y, degree=1, nk=21)
41  doy ~ wind+humidity+temp+vis     degree 1  nk 21  nTerms 6  of 26  GRSq 0.18 GRSq ratio 1.3 
Selected 6 of 15 terms, and 3 of 4 predictors
Number of terms at each degree of interaction: 1 5 (additive model)
GCV: 8981     RSS: 2769457     GRSq: 0.18     RSq: 0.23 
> 
> x <- cbind(wind, humidity, temp, vis)
> y <- doy
> itest <- itest+1; ozone.test(itest, "doy ~ wind+humidity+temp+vis", x, y, degree=2, nk=21)
42  doy ~ wind+humidity+temp+vis     degree 2  nk 21  nTerms 10 of 92  GRSq 0.22 GRSq ratio 1.8 
Selected 10 of 20 terms, and 3 of 4 predictors
Number of terms at each degree of interaction: 1 2 7
GCV: 8563     RSS: 2437753     GRSq: 0.22     RSq: 0.32 
> 
> # this is a basic test of RegressAndFix (because this generates lin dep bx cols)
> 
> cat("--Expect warning from mda::mars: NAs introduced by coercion\n") # why do we get a warning?
--Expect warning from mda::mars: NAs introduced by coercion
> x <- cbind(wind, exp(humidity))
> y <- doy
> # col.loess is 0 else get loess errors
> itest <- itest+1; ozone.test(itest, "doy ~ wind+exp(humidity)", x, y, degree=1, nk=21, col.loess=0)
43  doy ~ wind+exp(humidity)         degree 1  nk 21  nTerms 3  of 8   GRSq  0.1 GRSq ratio 1.6 
Selected 3 of 5 terms, and 1 of 2 predictors
Number of terms at each degree of interaction: 1 2 (additive model)
GCV: 9825     RSS: 3144854     GRSq: 0.1     RSq: 0.12 
Warning message:
NAs introduced by coercion 
> 
> x <- cbind(vh,wind,humidity,temp,ibh,dpg,ibt,vis,doy)
> y <- O3
> itest <- itest+1; ozone.test(itest, "O3~.", x, y, degree=2, nk=21)
44  O3~.                             degree 2  nk 21  nTerms 11 of 109 GRSq 0.79 GRSq ratio 1.0 
Selected 11 of 21 terms, and 8 of 9 predictors
Number of terms at each degree of interaction: 1 5 5
GCV: 13     RSS: 3762     GRSq: 0.79     RSq: 0.82 
> 
> x <- cbind(vh,wind,humidity,temp,ibh,dpg,ibt,vis,doy)
> y <- O3
> itest <- itest+1; a<-ozone.test(itest, "O3~., nk=51", x, y, degree=2, nk=51)
45  O3~., nk=51                      degree 2  nk 51  nTerms 28 of 734 GRSq 0.81 GRSq ratio 1.0 
> 
> detach(ozone1)
> 
> options(options.old)
> 
> #--- subset ----------------------------------------------------------------------------------
> 
> set.seed(9)
> train.subset <- sample(1:nrow(ozone1), .8 * nrow(ozone1))
> test.subset <- (1:nrow(ozone1))[-train.subset]
> 
> # all the following models should be identical
> a <- earth(ozone1[,-1], ozone1[,1], subset=train.subset, nprune=7, degree=2)
> print(a)
Selected 7 of 21 terms, and 5 of 9 predictors
Number of terms at each degree of interaction: 1 5 1
GCV: 15.90627     RSS: 3705.678     GRSq: 0.7513819     RSq: 0.7789326 
> a <- earth(ozone1[train.subset,-1], ozone1[train.subset,1], nprune=7, degree=2)
> print(a)
Selected 7 of 21 terms, and 5 of 9 predictors
Number of terms at each degree of interaction: 1 5 1
GCV: 15.90627     RSS: 3705.678     GRSq: 0.7513819     RSq: 0.7789326 
> a <- earth(O3 ~ ., data=ozone1, subset=train.subset, nprune=7, degree=2)
> print(a)
Selected 7 of 21 terms, and 5 of 9 predictors
Number of terms at each degree of interaction: 1 5 1
GCV: 15.90627     RSS: 3705.678     GRSq: 0.7513819     RSq: 0.7789326 
> 
> y <- ozone1[test.subset, 1]
> yhat <- predict(a, newdata = ozone1[test.subset, -1])
> print(1 - sum((y - yhat)^2)/sum((y - mean(y))^2)) # print RSquared
[1] 0.7219339
> 
> #--- ppenalty and update----------------------------------------------------------------------
> 
> a <- earth(O3 ~ ., data=ozone1, degree=2)
> print(update(a, ppenalty = -1))
Selected 21 of 21 terms, and 8 of 9 predictors
Number of terms at each degree of interaction: 1 10 10
GCV: 10.75936     RSS: 3550.59     GRSq: 0.8318484     RSq: 0.8318484 
> print(update(a, ppenalty = 10))
Selected 10 of 21 terms, and 7 of 9 predictors
Number of terms at each degree of interaction: 1 5 4
GCV: 17.15690     RSS: 3931.79     GRSq: 0.7334877     RSq: 0.8137952 
> a <- earth(O3 ~ ., data=ozone1, nk=31, pmethod="n", degree=2)
> a.none <- print(update(a, nprune=10, pmethod="n"))
Selected 10 of 31 terms, and 5 of 9 predictors
Number of terms at each degree of interaction: 1 6 3
GCV: 13.81158     RSS: 3931.79     GRSq: 0.7854534     RSq: 0.8137952 
> print(update(a.none, pmethod="b"))
Selected 10 of 31 terms, and 7 of 9 predictors
Number of terms at each degree of interaction: 1 5 4
GCV: 13.81158     RSS: 3931.79     GRSq: 0.7854534     RSq: 0.8137952 
> print(update(a.none, nprune=4, pmethod="e"))
Selected 4 of 31 terms, and 3 of 9 predictors
Number of terms at each degree of interaction: 1 2 1
GCV: 18.56806     RSS: 5815.867     GRSq: 0.711567     RSq: 0.7245676 
> a.updated <- update(a.none, nprune=10, pmethod="b")
> print(a.updated)
Selected 10 of 31 terms, and 7 of 9 predictors
Number of terms at each degree of interaction: 1 5 4
GCV: 13.81158     RSS: 3931.79     GRSq: 0.7854534     RSq: 0.8137952 
> a.backwards <- update(a, nprune=10, pmethod="b")
> print(a.backwards)
Selected 10 of 31 terms, and 7 of 9 predictors
Number of terms at each degree of interaction: 1 5 4
GCV: 13.81158     RSS: 3931.79     GRSq: 0.7854534     RSq: 0.8137952 
> stopifnot(all.equal(a.updated$bx, a.backwards$bx))
> a <- earth(O3 ~ ., data=ozone1, nk=31, nprune=10, pmethod="b", degree=2)
> print(a)
Selected 10 of 31 terms, and 7 of 9 predictors
Number of terms at each degree of interaction: 1 5 4
GCV: 13.81158     RSS: 3931.79     GRSq: 0.7854534     RSq: 0.8137952 
> stopifnot(all.equal(a$bx, a.backwards$bx))
> 
> #--- fast mars -------------------------------------------------------------------------------
> 
> print(earth(O3 ~ ., data=ozone1, degree=2, nk = 31, fast.k = -1, fast.beta = 1))
Selected 17 of 31 terms, and 9 of 9 predictors
Number of terms at each degree of interaction: 1 5 11
GCV: 13.38345     RSS: 3387.271     GRSq: 0.7921038     RSq: 0.839583 
> print(earth(O3 ~ ., data=ozone1, degree=2, nk = 31, fast.k = -1, fast.beta = 0))
Selected 17 of 31 terms, and 9 of 9 predictors
Number of terms at each degree of interaction: 1 5 11
GCV: 13.38345     RSS: 3387.271     GRSq: 0.7921038     RSq: 0.839583 
> print(earth(O3 ~ ., data=ozone1, degree=2, nk = 31, fast.k = 5, fast.beta = 1))
Selected 17 of 30 terms, and 9 of 9 predictors
Number of terms at each degree of interaction: 1 8 8
GCV: 12.97698     RSS: 3284.396     GRSq: 0.7984178     RSq: 0.844455 
> print(earth(O3 ~ ., data=ozone1, degree=2, nk = 31, fast.k = 5, fast.beta = 0))
Selected 11 of 31 terms, and 8 of 9 predictors
Number of terms at each degree of interaction: 1 5 5
GCV: 13.43422     RSS: 3762.234     GRSq: 0.7913151     RSq: 0.8218252 
> 
> # --- plot.earth and plot.earth.models--------------------------------------------------------
> 
> a <- earth(O3 ~ ., data=ozone1) # formula interface
> 
> plot(a, sub.caption="plot.earth test 1", col.rsq=3, col.loess=4, col.qq="pink", 
+     col.vline=1, col.npreds=0, nresiduals=100, cum.grid="grid")
> 
> set.seed(1)
> plot(a, sub.caption="plot.earth test 2", which=c(3,4,1), rlim=c(.2,.9), 
+     jitter=.01, id.n=5, legend.pos=c(10,.4), pch=20, lty.vline=1)
> 
> plot(a, sub.caption="plot.earth test 3", which=c(2), main="test main")
> 
> a1 <- earth(ozone1[,c(2:4,10)], ozone1[,1])     # x,y interface
> 
> plot(a, sub.caption="plot.earth test 4", id.n=1)
> 
> set.seed(1)
> plot.earth.models(a, which=1, rlim=c(.4,.8), jitter=.01)
> 
> plot.earth.models(a1)
> 
> plot.earth.models(list(a, a1), col.cum=c(3,4),  col.grsq=c(1,2), col.rsq=c(3,4),
+     col.npreds=1, col.vline=1, lty.vline=3,
+     col.grid="pink", cum.grid="grid", legend.pos=c(5,.4), 
+     legend.text=c("a", "b", "c"))
> 
> # --- extractAIC.earth -----------------------------------------------------------------------
> 
> a <-earth(O3 ~ ., data=ozone1, degree=2)
> cat("Ignore 10 warnings: extractAIC.earth: using GCV instead of AIC\n")
Ignore 10 warnings: extractAIC.earth: using GCV instead of AIC
> print(drop1(a))
Single term deletions

Model:
O3 ~ vh + wind + humidity + temp + ibh + dpg + ibt + vis + doy
            Df    AIC
<none>         13.434
vh         0.0 13.434
wind      -2.5 13.455
humidity -12.5 15.195
temp     -10.0 13.146
ibh        0.0 12.988
dpg        0.0 14.666
ibt       -5.0 13.869
vis       -2.5 13.895
doy       -2.5 15.583
Warning messages:
1: extractAIC.earth: using GCV instead of AIC 
2: extractAIC.earth: using GCV instead of AIC 
3: extractAIC.earth: using GCV instead of AIC 
4: extractAIC.earth: using GCV instead of AIC 
5: extractAIC.earth: using GCV instead of AIC 
6: extractAIC.earth: using GCV instead of AIC 
7: extractAIC.earth: using GCV instead of AIC 
8: extractAIC.earth: using GCV instead of AIC 
9: extractAIC.earth: using GCV instead of AIC 
10: extractAIC.earth: using GCV instead of AIC 
> 
> #--- tests/test.earth.R ----------------------------------------------------------------------
> 
> cat("--- ../../tests/test.earth.R -------------------------\n")
--- ../../tests/test.earth.R -------------------------
> source("../../tests/test.earth.R")
BetaCache 0.030 Mb
Forward pass: model matrix 330 x 9 minspan 8 endspan 15

         GRSq    RSq   DeltaRSq         RSS Pred PredName         Cut  Terms   Parents
1      0.0000 0.0000              2.112e+04                            1
2      0.6493 0.6599       0.6599   7181.92    4     temp          58  2   3   
4      0.6903 0.7088      0.04898   6147.78    5      ibh        1108  4   5   
6      0.7102 0.7361      0.02722   5573.05    9      doy          92  6   7   
8      0.7295 0.7614      0.02532   5038.41    3 humidity          55  8   9   2   
10     0.7546 0.7904      0.02906    4424.8    6      dpg          54  10  11  2   
12     0.7597 0.8015      0.01109   4190.65    8      vis         200  12  13  
14     0.7632 0.8109     0.009396   3992.24    2     wind           7  14  15  13  
16      0.764 0.8179      0.00697   3845.07    6      dpg          44  16  17  5   
18     0.7685 0.8275     0.009595   3642.46    7      ibt         234  18  19  
20     0.7662 0.8318     0.004351   3550.59    9      doy         159  20  21  2   

Reached max number of terms 21
Forward pass complete: 21 terms

Subset size         GCV         GRSq      RSq  nPreds  Terms (index into bx)
          1     64.3756       0.0000   0.0000       0  1
          2     23.1254       0.6408   0.6462       1  1 2
          3     19.8917       0.6910   0.7003       2  1 2 4
          4     19.1727       0.7022   0.7156       3  1 2 9 19
          5     18.5807       0.7114   0.7286       4  1 2 6 9 19
          6     16.8746       0.7379   0.7574       4  1 2 6 7 9 19
          7     15.6677       0.7566   0.7783       5  1 2 6 7 9 11 19
          8     15.0794       0.7658   0.7900       6  1 2 6 7 9 11 13 19
          9     14.3402       0.7772   0.8035       7  1 2 6 7 9 11 13 17 19
         10     13.8116       0.7855   0.8138       7  1 2 6 7 9 10 11 13 17 19
chosen   11     13.4342       0.7913   0.8218       8  1 2 6 7 9 10 11 13 14 17 19
         12     13.5372       0.7897   0.8234       8  1 2 6 7 9 10 11 13 14 17 19 20
         13     13.5644       0.7893   0.8260       8  1 2 6 7 9 10 11 13 14 17 19 20 21
         14     13.7185       0.7869   0.8269       8  1 2 5 6 7 9 10 11 13 14 17 19 20 21
         15     13.8221       0.7853   0.8285       8  1 2 5 6 7 9 10 11 13 14 16 17 19 20 21
         16     13.9597       0.7832   0.8298       8  1 2 5 6 7 9 10 11 13 14 15 16 17 19 20 21
         17     14.1209       0.7806   0.8307       8  1 2 5 6 7 8 9 10 11 13 14 15 16 17 19 20 21
         18     14.3315       0.7774   0.8312       8  1 2 4 5 6 7 8 9 10 11 13 14 15 16 17 19 20 21
         19     14.5533       0.7739   0.8315       8  1 2 3 4 5 6 7 8 9 10 11 13 14 15 16 17 19 20 21
         20     14.7946       0.7702   0.8318       8  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 19 20 21
         21     15.0524       0.7662   0.8318       8  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21

Prune method "backward" ppenalty 3 nprune 21: selected 11 of 21 terms, and 8 of 9 predictors
GRSq: 0.7913 RSq: 0.8218 
Selected 11 of 21 terms, and 8 of 9 predictors
Number of terms at each degree of interaction: 1 5 5
GCV: 13.4     RSS: 3762     GRSq: 0.791     RSq: 0.822 
Call:
earth(formula = O3 ~ ., data = ozone1, degree = 2, trace = 4)

Expression:
  15 
  +    0.313 * pmax(0,     temp -       58) 
  -    0.046 * pmax(0,      234 -      ibt) 
  +   0.0221 * pmax(0,      200 -      vis) 
  -   0.0237 * pmax(0,      doy -       92) 
  -    0.134 * pmax(0,       92 -      doy) 
  -   0.0186 * pmax(0,     wind -        7) * pmax(0,      200 -      vis) 
  -   0.0219 * pmax(0,       55 - humidity) * pmax(0,     temp -       58) 
  -   0.0189 * pmax(0,     temp -       58) * pmax(0,      dpg -       54) 
  +  0.00416 * pmax(0,     temp -       58) * pmax(0,       54 -      dpg) 
  - 7.74e-05 * pmax(0,     1108 -      ibh) * pmax(0,       44 -      dpg) 

Number of cases: 330
Selected 11 of 21 terms, and 8 of 9 predictors
Number of terms at each degree of interaction: 1 5 5
GCV: 13.4     RSS: 3762     GRSq: 0.791     RSq: 0.822 
Selected 5 of 21 terms, and 4 of 9 predictors
Number of terms at each degree of interaction: 1 3 1
GCV: 18.6     RSS: 5730     GRSq: 0.711     RSq: 0.729 

0 1 2 
1 3 1 
[1] 0 1 1 1 1 1 1 2 2
[1] "1" "2" "3"
[1] "vh"       "wind"     "humidity"
[1] 5730
[1] 1 2 5 3 4
[1] 6.63
> 
> 