> # test.earth.big: test earth with a biggish model
> 
> library(earth)
Loading required package: leaps
> if(!interactive())
+     postscript()
> options(digits = 3)
> set.seed(777)
> N <- 1e4
> 
> ran <- function() runif(N, min=-1, max=1)
> 
> x <- cbind(
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), 
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), 
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), 
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), 
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), 
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), 
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), 
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), 
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran())
> 
> colnames(x) <- c(
+     "x01", "x02", "x03", "x04", "x05", "x06", "x07", "x08", "x09", "x10",
+     "x11", "x12", "x13", "x14", "x15", "x16", "x17", "x18", "x19", "x20",
+     "x21", "x22", "x23", "x24", "x25", "x26", "x27", "x28", "x29", "x30",
+     "x31", "x32", "x33", "x34", "x35", "x36", "x37", "x38", "x39", "x40",
+     "x41", "x42", "x43", "x44", "x45", "x46", "x47", "x48", "x49", "x50",
+     "x51", "x52", "x53", "x54", "x55", "x56", "x57", "x58", "x59", "x60",
+     "x61", "x62", "x63", "x64", "x65", "x66", "x67", "x68", "x69", "x70",
+     "x71", "x72", "x73", "x74", "x75", "x76", "x77", "x78", "x79", "x80",
+     "x81", "x82", "x83", "x84", "x85", "x86", "x87", "x88", "x89", "x90",
+     "x91", "x92", "x93", "x94", "x95", "x96", "x97", "x98", "x99", "x100")
> 
> func1 <- function(x)
+ {
+      sin(6 * x[,1]) + x[,2] + 4 * x[,3] * x[,3]
+ }
> y <- func1(x)
> degree=1
> nk=51
> trace=0
> cat("test 1: nrow(x)", nrow(x), "ncol(x)", ncol(x), "degree", degree, "nk", nk, "trace", trace, "\n")
test 1: nrow(x) 10000 ncol(x) 100 degree 1 nk 51 trace 0 
> a1 <- earth(x, y, nk=51, degree=degree, minspan=0, trace=trace)
> print(summary(a1))
Call:
earth(x = x, y = y, trace = trace, nk = 51, degree = degree, 
    minspan = 0)

Expression:
  -2.47 
  -   1.48 * pmax(0,    x01 - -0.395) 
  +   2.79 * pmax(0, -0.395 -    x01) 
  +   6.68 * pmax(0,    x01 - -0.136) 
  -   10.3 * pmax(0,    x01 -  0.275) 
  +   8.17 * pmax(0,    x01 -  0.752) 
  +  0.948 * pmax(0,    x02 -   0.81) 
  -      1 * pmax(0,   0.81 -    x02) 
  +    4.3 * pmax(0,    x03 - -0.588) 
  -      2 * pmax(0,    x03 - 0.0153) 
  +   6.63 * pmax(0, 0.0153 -    x03) 
  +   3.69 * pmax(0,    x03 -  0.513) 
Number of cases: 10000
Selected 12 of 12 terms, and 3 of 100 predictors
Number of terms at each degree of interaction: 1 11 (additive model)
GCV: 0.0654       RSS: 651          GRSq: 0.971      RSq: 0.971
> print(a1)
Selected 12 of 12 terms, and 3 of 100 predictors
Number of terms at each degree of interaction: 1 11 (additive model)
GCV: 0.0654       RSS: 651          GRSq: 0.971      RSq: 0.971
> plot(a1)
> plotmo(a1)
> 
> func2 <- function(x)
+ {
+      x[,1] + x[,2] + x[,3] * x[,4]
+ }
> cat("test 2: nrow(x)", nrow(x), "ncol(x)", ncol(x), "degree", degree, "nk", nk, "trace", trace, "\n")
test 2: nrow(x) 10000 ncol(x) 100 degree 1 nk 51 trace 0 
> y <- func2(x)
> trace=4
> a2 <- earth(x, y, nk=51, degree=degree, minspan=0, trace=trace)
Call: earth.default(x=x,y=y,trace=trace,nk=51,degree=degree, minspan=0)

Predictors 1=x01 2=x02 3=x03 4=x04 5=x05 6=x06 7=x07 8=x08 9=x09 10=x10 11=x11 12=x12 13=x13 14=x14 15=x15 16=x16 17=x17 18=x18 19=x19 20=x20 21=x21 22=x22 23=x23 24=x24 25=x25 26=x26 27=x27 28=x28 29=x29 30=x30 31=x31 32=x32 33=x33 34=x34 35=x35 36=x36 37=x37 38=x38 39=x39 40=x40 41=x41 42=x42 43=x43 44=x44 45=x45 46=x46 47=x47 48=x48 49=x49 50=x50 51=x51 52=x52 53=x53 54=x54 55=x55 56=x56 57=x57 58=x58 59=x59 60=x60 61=x61 62=x62 63=x63 64=x64 65=x65 66=x66 67=x67 68=x68 69=x69 70=x70 71=x71 72=x72 73=x73 74=x74 75=x75 76=x76 77=x77 78=x78 79=x79 80=x80 81=x81 82=x82 83=x83 84=x84 85=x85 86=x86 87=x87 88=x88 89=x89 90=x90 91=x91 92=x92 93=x93 94=x94 95=x95 96=x96 97=x97 98=x98 99=x99 100=x100 

Forward pass: model matrix[10000,100]   y[10000,1]   minspan 12   endspan 20

         GRSq    RSq     DeltaRSq       RSS Pred PredName         Cut  Terms   Parents
1      0.0000 0.0000                   7771                            1
2      0.4293 0.4298       0.4298   4431.04    2      x02     0.90738  2   3   
4      0.8588 0.8590       0.4292    1095.7    1      x01     0.76168  4   5   
6      0.8589 0.8592    0.0002234   1093.96   81      x81     0.62835  6   7   reject term

GRSq: 0.8589 RSq: 0.8592
Reached delta RSq threshold (DeltaRSq 0.000223373 < 0.001)
Forward pass complete: 5 terms

Subset size         GCV         GRSq      RSq  nPreds  Terms (index into bx)
          1    0.777223       0.0000   0.0000       0  1
          2    0.443609       0.4292   0.4295       1  1 3
          3    0.111255       0.8569   0.8570       2  1 3 5
          4     0.10984       0.8587   0.8588       2  1 3 4 5
chosen    5    0.109767       0.8588   0.8590       2  1 2 3 4 5

Prune method "backward" penalty 2 nprune 5: selected 5 of 5 terms, and 2 of 100 predictors
GRSq: 0.8588 RSq: 0.859 
> print(summary(a2))
Call:
earth(x = x, y = y, trace = trace, nk = 51, degree = degree, 
    minspan = 0)

Expression:
  1.68 
  + 0.923 * pmax(0,   x01 - 0.762) 
  -  1.01 * pmax(0, 0.762 -   x01) 
  +  1.01 * pmax(0,   x02 - 0.907) 
  -     1 * pmax(0, 0.907 -   x02) 
Number of cases: 10000
Selected 5 of 5 terms, and 2 of 100 predictors
Number of terms at each degree of interaction: 1 4 (additive model)
GCV: 0.110        RSS: 1096         GRSq: 0.859      RSq: 0.859
> 
> if(!interactive()) {
+     dev.off()         # finish postscript plot
+     q(runLast=FALSE)  # needed else R prints the time on exit (R2.5 and higher) which messes up the diffs
+ }
