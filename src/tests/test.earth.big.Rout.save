> # test.earth.big: test earth with a biggish model
> 
> library(earth)
Loading required package: leaps
Loading required package: plotmo
Loading required package: plotrix
> source("fast.postscript.R")
> if(!interactive())
+     fast.postscript(paper="letter")
Opening Rplots.ps 
> options(warn=1) # print warnings as they occur
> options(digits = 3)
> set.seed(777)
> N <- 1e4
> 
> ran <- function() runif(N, min=-1, max=1)
> 
> x <- cbind(
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran())
> 
> colnames(x) <- c(
+     "x01", "x02", "x03", "x04", "x05", "x06", "x07", "x08", "x09", "x10",
+     "x11", "x12", "x13", "x14", "x15", "x16", "x17", "x18", "x19", "x20",
+     "x21", "x22", "x23", "x24", "x25", "x26", "x27", "x28", "x29", "x30",
+     "x31", "x32", "x33", "x34", "x35", "x36", "x37", "x38", "x39", "x40",
+     "x41", "x42", "x43", "x44", "x45", "x46", "x47", "x48", "x49", "x50",
+     "x51", "x52", "x53", "x54", "x55", "x56", "x57", "x58", "x59", "x60",
+     "x61", "x62", "x63", "x64", "x65", "x66", "x67", "x68", "x69", "x70",
+     "x71", "x72", "x73", "x74", "x75", "x76", "x77", "x78", "x79", "x80",
+     "x81", "x82", "x83", "x84", "x85", "x86", "x87", "x88", "x89", "x90",
+     "x91", "x92", "x93", "x94", "x95", "x96", "x97", "x98", "x99", "x100")
> 
> func1 <- function(x)
+ {
+      sin(6 * x[,1]) + x[,2] + 4 * x[,3] * x[,3]
+ }
> y <- func1(x)
> degree=1
> nk=51
> trace=0
> cat("test 1: nrow(x)", nrow(x), "ncol(x)", ncol(x), "degree", degree, "nk", nk, "trace", trace, "\n")
test 1: nrow(x) 10000 ncol(x) 100 degree 1 nk 51 trace 0 
> a1 <- earth(x, y, nk=51, degree=degree, minspan=0, trace=trace)
> print(summary(a1))
Call: earth(x=x, y=y, trace=trace, nk=51, degree=degree, 
      minspan=0)

                  coefficients
(Intercept)             -2.461
h(x01- -0.394676)       -1.490
h(-0.394676-x01)         2.794
h(x01- -0.136189)        6.682
h(x01-0.274633)        -10.309
h(x01-0.752643)          8.168
h(x02-0.811168)          0.947
h(0.811168-x02)         -1.000
h(x03- -0.587115)        4.296
h(x03-0.0156478)        -1.996
h(0.0156478-x03)         6.624
h(x03-0.512949)          3.687

Selected 12 of 12 terms, and 3 of 100 predictors 
Importance: x03, x02, x01, x04-unused, x05-unused, x06-unused, x07-unused, ...
Number of terms at each degree of interaction: 1 11 (additive model)
GCV 0.0652    RSS 649    GRSq 0.971    RSq 0.971
> print(a1)
Selected 12 of 12 terms, and 3 of 100 predictors 
Importance: x03, x02, x01, x04-unused, x05-unused, x06-unused, x07-unused, ...
Number of terms at each degree of interaction: 1 11 (additive model)
GCV 0.0652    RSS 649    GRSq 0.971    RSq 0.971
> plot(a1)
> plotmo(a1)

 grid:    x01      x02      x03      x04     x05    x06     x07     x08     x09
     -0.00358 -0.00702 -0.00386 -0.00925 0.00666 0.0153 0.00884 -0.0103 0.00119
      x10     x11     x12     x13    x14    x15    x16    x17      x18    x19
 -0.00157 0.00723 0.00135 -0.0107 0.0106 0.0131 0.0088 0.0168 -0.00038 0.0122
     x20     x21     x22      x23     x24      x25      x26     x27     x28
 -0.0036 0.00636 0.00531 0.000542 0.00647 -0.00491 -0.00257 0.00799 -0.0126
      x29    x30       x31     x32      x33     x34   x35     x36      x37
 -0.00653 0.0071 -2.64e-05 0.00126 -0.00537 -0.0045 0.015 0.00496 -0.00988
     x38    x39    x40      x41     x42      x43      x44      x45    x46
 -0.0062 -0.011 0.0111 0.000431 -0.0151 -0.00633 0.000193 -0.00347 0.0133
     x47      x48    x49   x50     x51     x52     x53      x54      x55  x56
 -0.0149 0.000321 0.0108 0.017 0.00526 0.00177 0.00664 0.000308 -0.00817 0.02
      x57      x58     x59     x60      x61     x62      x63     x64     x65
 -0.00184 0.000796 0.00459 -0.0145 -0.00811 -0.0077 -0.00113 0.00649 -0.0131
      x66     x67      x68    x69      x70     x71    x72    x73      x74
 -0.00251 0.00113 -0.00057 0.0132 -0.00248 0.00126 0.0226 0.0114 -0.00133
     x75     x76     x77       x78    x79      x80      x81    x82      x83
 0.00446 -0.0076 -0.0102 -0.000355 0.0221 -0.00503 -0.00424 -0.015 -0.00651
     x84     x85     x86      x87     x88     x89      x90     x91     x92
 -0.0063 -0.0132 0.00255 0.000623 0.00786 0.00661 0.000138 -0.0156 0.00465
     x93      x94      x95     x96     x97     x98     x99    x100
 0.00531 -0.00447 -0.00818 -0.0037 0.00271 0.00536 0.00109 -0.0051

> 
> func2 <- function(x)
+ {
+      x[,1] + x[,2] + x[,3] * x[,4]
+ }
> cat("test 2: nrow(x)", nrow(x), "ncol(x)", ncol(x), "degree", degree, "nk", nk, "trace", trace, "\n")
test 2: nrow(x) 10000 ncol(x) 100 degree 1 nk 51 trace 0 
> y <- func2(x)
> trace=4
> a2 <- earth(x, y, nk=51, degree=degree, minspan=0, trace=trace)
Call: earth(x=x, y=y, trace=trace, nk=51, degree=degree, 
      minspan=0)
x is a 10000 by 100 matrix: 1=x01, 2=x02, 3=x03, 4=x04, 5=x05, 6=x06, 7=x07, 8=x08, 9=x09, 10=x10, 11=x11, 12=x12, 13=x13, 14=x14, 15=x15, 16=x16, 17=x17, 18=x18, 19=x19, 20=x20, 21=x21, 22=x22, 23=x23, 24=x24, 25=x25, 26=x26, 27=x27, 28=x28, 29=x29, 30=x30, 31=x31, 32=x32, 33=x33, 34=x34, 35=x35, 36=x36, 37=x37, 38=x38, 39=x39, 40=x40, 41=x41, 42=x42, 43=x43, 44=x44, 45=x45, 46=x46, 47=x47, 48=x48, 49=x49, 50=x50, 51=x51, 52=x52, 53=x53, 54=x54, 55=x55, 56=x56, 57=x57, 58=x58, 59=x59, 60=x60, 61=x61, 62=x62, 63=x63, 64=x64, 65=x65, 66=x66, 67=x67, 68=x68, 69=x69, 70=x70, 71=x71, 72=x72, 73=x73, 74=x74, 75=x75, 76=x76, 77=x77, 78=x78, 79=x79, 80=x80, 81=x81, 82=x82, 83=x83, 84=x84, 85=x85, 86=x86, 87=x87, 88=x88, 89=x89, 90=x90, 91=x91, 92=x92, 93=x93, 94=x94, 95=x95, 96=x96, 97=x97, 98=x98, 99=x99, 100=x100
First few rows of x are
         x01    x02     x03    x04     x05     x06    x07    x08    x09    x10
[1,]  0.3757 -0.593 -0.9298 -0.346  0.4485  0.1227 -0.579  0.433  0.741 -0.116
[2,] -0.0156  0.131  0.2874 -0.539  0.3421 -0.0321 -0.698 -0.627  0.529 -0.427
[3,] -0.3098 -0.448 -0.0346 -0.625 -0.1843 -0.4007 -0.322 -0.458 -0.816 -0.728
[4,]  0.9901 -0.052  0.2611  0.584 -0.0027  0.6180 -0.631 -0.350 -0.396 -0.974
[5,]  0.3905  0.410  0.9872  0.393  0.7713  0.4219 -0.860 -0.792 -0.643 -0.784
[6,] -0.9786  0.756 -0.8258 -0.754  0.3615 -0.8083  0.477  0.850  0.825 -0.437
         x11    x12    x13    x14    x15    x16    x17     x18     x19     x20
[1,]  0.5225  0.643  0.164  0.465  0.146  0.868  0.564 -0.7875  0.9657  0.4690
[2,]  0.8110 -0.916  0.312  0.993  0.341 -0.229  0.722 -0.4800  0.0191 -0.6608
[3,] -0.7853  0.363  0.692  0.324 -0.859 -0.455 -0.669  0.7618  0.0536  0.8859
[4,] -0.2899 -0.608 -0.687  0.849 -0.436  0.417 -0.462 -0.0108  0.4085  0.6810
[5,]  0.9196 -0.625 -0.937  0.557  0.370 -0.882  0.478  0.5118 -0.3812  0.8295
[6,] -0.0971  0.495  0.421 -0.336  0.617 -0.892  0.547  0.9397 -0.6423 -0.0539
          x21   x22    x23     x24     x25    x26    x27     x28    x29     x30
[1,] -0.91839 0.410  0.838  0.4605 -0.9042 -0.180  0.036 -0.0396  0.127 -0.8069
[2,] -0.00274 0.491  0.727  0.0138  0.4402 -0.283  0.702 -0.8060  0.662 -0.9341
[3,]  0.08769 0.550  0.380  0.1973 -0.1354 -0.861 -0.566  0.9819  0.217 -0.8626
[4,]  0.61940 0.040 -0.740 -0.2887  0.0828 -0.453 -0.439 -0.8614 -0.169 -0.0552
[5,] -0.08520 0.071  0.867 -0.3464  0.4840  0.767 -0.922  0.0379 -0.293  0.9936
[6,]  0.07783 0.562  0.344 -0.0824 -0.9851  0.553  0.846  0.7984  0.876  0.7932
        x31    x32     x33     x34    x35     x36    x37     x38    x39     x40
[1,]  0.475 -0.973  0.0105 -0.3984 -0.208 -0.7979  0.870  0.9612 -0.429  0.0186
[2,]  0.148 -0.303 -0.1937 -0.0344 -0.773 -0.1284 -0.191  0.8662  0.133  0.9638
[3,] -0.947  0.890 -0.2287 -0.4555  0.447  0.3688 -0.269 -0.9473 -0.595 -0.2260
[4,]  0.406 -0.122 -0.2059 -0.0633 -0.158 -0.6996 -0.341 -0.1496  0.566 -0.9405
[5,] -0.479 -0.346 -0.0914 -0.6348  0.625 -0.1504 -0.952 -0.0178  0.965  0.1418
[6,]  0.818 -0.285  0.7308 -0.4518  0.359 -0.0443  0.388  0.3421 -0.942  0.9511
        x41    x42      x43    x44    x45     x46     x47     x48    x49    x50
[1,]  0.942 -0.433  0.56485  0.139 -0.678 -0.4623  0.6460 -0.1733  0.117 -0.166
[2,]  0.178  0.456  0.96103 -0.165  0.454 -0.0742  0.3867  0.6799 -0.966  0.715
[3,]  0.337 -0.517 -0.00831  0.690  0.492 -0.5876 -0.0868  0.0573 -0.634  0.916
[4,]  0.143 -0.184 -0.64246 -0.868 -0.386  0.6851 -0.8190 -0.1108  0.146 -0.831
[5,] -0.643  0.617 -0.92415 -0.920 -0.590 -0.8497  0.7496  0.7203  0.453  0.635
[6,] -0.412 -0.345  0.56976 -0.289  0.109 -0.0721 -0.1265  0.6199  0.920  0.866
        x51     x52    x53     x54    x55    x56     x57    x58    x59     x60
[1,]  0.150  0.4466 -0.485 -0.7845  0.363  0.428  0.8798 -0.512 -0.288  0.6520
[2,] -0.882 -0.2302 -0.923  0.4511 -0.989 -0.452  0.0775  0.309  0.531  0.4812
[3,]  0.655  0.0603 -0.367 -0.2797 -0.645  0.824  0.0775 -0.570 -0.684  0.3717
[4,]  0.956  0.9842 -0.137 -0.0402 -0.264 -0.856  0.5701  0.128 -0.417 -0.4056
[5,] -0.531  0.6037  0.296  0.3718  0.195 -0.964 -0.8414  0.968  0.981  0.6019
[6,] -0.160 -0.0895 -0.771  0.0541  0.191  0.388 -0.0778  0.752  0.113  0.0781
       x61     x62    x63    x64     x65     x66     x67     x68    x69    x70
[1,] 0.225 -0.7062 -0.592  0.745  0.7988  0.6972  0.0518 -0.1540  0.920 -0.070
[2,] 0.053 -0.8290 -0.720 -0.242 -0.9810 -0.4093 -0.3823  0.3476 -0.460  0.654
[3,] 0.523 -0.5161 -0.623 -0.373 -0.2857  0.0627  0.1136  0.9266  0.653 -0.788
[4,] 0.686  0.0262  0.543 -0.963 -0.3340 -0.5785  0.0264  0.4586  0.527 -0.763
[5,] 0.738  0.6866 -0.861  0.133 -0.1971 -0.0412  0.7045  0.0117  0.865  0.225
[6,] 0.330  0.7758 -0.980 -0.932  0.0495 -0.7598 -0.7960  0.2429 -0.962 -0.459
        x71    x72    x73    x74     x75     x76    x77     x78     x79     x80
[1,] -0.944  0.197  0.582 -0.827  0.0815 -0.0357 -0.062  0.0699 -0.2011  0.8192
[2,] -0.321 -0.738  0.883  0.553 -0.2775 -0.2126  0.728  0.0355  0.5917  0.3637
[3,]  0.940  0.421  0.571 -0.926 -0.8680 -0.4515 -0.774 -0.7491 -0.7199  0.8092
[4,]  0.824  0.984 -0.333 -0.507  0.0628  0.0197  0.460 -0.6224  0.0367  0.0498
[5,]  0.848  0.930 -0.317 -0.183  0.0233  0.4500 -0.497 -0.5804  0.7373  0.4092
[6,]  0.649 -0.377 -0.353 -0.410  0.3541 -0.4087 -0.751  0.2816 -0.5246 -0.5949
        x81    x82    x83    x84     x85    x86     x87    x88      x89    x90
[1,] -0.223 -0.577 -0.751  0.942 -0.9863  0.692 -0.0206 -0.411 -0.87119  0.387
[2,]  0.908 -0.342  0.771 -0.215  0.6272 -0.599  0.0533  0.182  0.91405  0.432
[3,] -0.390 -0.451  0.903  0.363 -0.0557  0.278  0.4091  0.310  0.12794  0.310
[4,]  0.715  0.413 -0.814  0.355  0.1989 -0.953 -0.0592  0.401  0.00912  0.036
[5,] -0.282 -0.709  0.723  0.166  0.1487 -0.173 -0.9350 -0.488  0.68676  0.181
[6,] -0.559  0.292  0.962  0.296 -0.5816  0.654 -0.0598  0.514 -0.99502 -0.849
         x91     x92    x93    x94    x95    x96     x97    x98     x99   x100
[1,]  0.0807 -0.6212 -0.625  0.424 -0.454 -0.390 -0.6075 -0.726  0.0455 -0.279
[2,]  0.7650 -0.9641 -0.999 -0.682 -0.644  0.976 -0.4338  0.814  0.0303 -0.931
[3,] -0.3141 -0.0740 -0.893  0.935 -0.819  0.189  0.0248 -0.759 -0.6202  0.545
[4,]  0.0151 -0.9770 -0.703 -0.471 -0.642 -0.174  0.0361  0.938 -0.1776 -0.864
[5,]  0.5266 -0.0506  0.576 -0.676 -0.627 -0.746 -0.1893  0.885  0.1989 -0.507
[6,] -0.5461  0.7873  0.662 -0.977  0.987  0.572  0.9279 -0.636  0.8533  0.630
y is a 10000 by 1 matrix: 1=y
First few rows of y are
           y
[1,]  0.1044
[2,] -0.0391
[3,] -0.7367
[4,]  1.0904
[5,]  1.1888
[6,]  0.4007
Forward pass: minspan 9 endspan 13

         GRSq    RSq     DeltaRSq Pred     PredName         Cut  Terms   ParentTerm
1      0.0000 0.0000                                             1
2      0.4293 0.4298       0.4298    2          x02     0.99615  2   3   
4      0.8588 0.8590       0.4292    1          x01     0.76136  4   5   
6      0.8589 0.8592    0.0002223   81          x81     0.62626  6   7   reject term

Reached delta RSq threshold (DeltaRSq 0.000222344 < 0.001) at 5 terms
After forward pass GRSq 0.8589 RSq 0.8592
Forward pass complete: 5 terms

Subset size        GRSq     RSq  DeltaGRSq nPreds  Terms (col nbr in bx)
          1      0.0000  0.0000     0.0000      0  1
          2      0.4295  0.4297     0.4295      1  1 3
          3      0.8570  0.8571     0.4275      2  1 3 5
chosen    4      0.8588  0.8590     0.0018      2  1 3 4 5
          5      0.8588  0.8590    -0.0000      2  1 2 3 4 5

Prune method "backward" penalty 2 nprune 5: selected 4 of 5 terms, and 2 of 100 predictors
After backward pass GRSq 0.8588 RSq 0.859 
> print(summary(a2))
Call: earth(x=x, y=y, trace=trace, nk=51, degree=degree, 
      minspan=0)

                coefficients
(Intercept)            1.765
h(x01-0.761359)        0.923
h(0.761359-x01)       -1.008
h(0.996147-x02)       -1.000

Selected 4 of 5 terms, and 2 of 100 predictors 
Importance: x02, x01, x03-unused, x04-unused, x05-unused, x06-unused, ...
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 0.11    RSS 1096    GRSq 0.859    RSq 0.859
> 
> if(!interactive()) {
+     dev.off()         # finish postscript plot
+     q(runLast=FALSE)  # needed else R prints the time on exit (R2.5 and higher) which messes up the diffs
+ }
