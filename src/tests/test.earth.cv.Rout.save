> # test.earth.cv.R: test earth cross validation
> 
> library(earth)
Loading required package: leaps
Loading required package: plotrix
Warning message:
package 'plotrix' was built under R version 2.12.1 
> if(!interactive())
+     postscript(paper="letter")
> data(ozone1)
> data(trees)
> data(etitanic)
> options(warn=2)
> options(width=200)
> 
> printh <- function(x, expect.warning=FALSE, max.print=0) # like print but with a header
+ {
+     cat("===", deparse(substitute(x)))
+     if(expect.warning)
+         cat(" expect warning -->")
+     else if (NROW(x) > 1)
+         cat("\n")
+     if (max.print > 0)
+         print(head(x, n=max.print))
+     else
+         print(x)
+ }
> 
> # print contents of earth.model, for sanity checking that all fields are present as usual
> # but strip big fields to reduce amount of printing
> 
> print.stripped.earth.model <- function(a, model.name)
+ {
+     a$bx <- NULL
+     a$fitted.values <- NULL
+     a$residuals <- NULL
+     cat("print.stripped.earth.model(", model.name, ")\n", sep="")
+     print.default(a)
+     cat("-------------------------------------------------------------------------------\n\n")
+ }
> 
> cat("a0: trees\n\n")
a0: trees

> 
> set.seed(23)
> a0 <- earth(Volume ~ ., data = trees, trace=0.5, nfold=3)
CV fold  1: CV-RSq 0.953  ntrain-nz 20 ntest-nz 11 
CV fold  2: CV-RSq 0.926  ntrain-nz 21 ntest-nz 10 
CV fold  3: CV-RSq 0.973  ntrain-nz 21 ntest-nz 10 
CV all:     CV-RSq 0.951  ntrain-nz 31 

> printh(a0$cv.rsq.tab)
=== a0$cv.rsq.tab
          Volume      mean
fold 1 0.9525513 0.9525513
fold 2 0.9259537 0.9259537
fold 3 0.9730188 0.9730188
mean   0.9505079 0.9505079
> printh(a0)
=== a0
Selected 4 of 6 terms, and 2 of 2 predictors 
Importance: Girth, Height
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 10.60632    RSS 197.0722    GRSq 0.962013    RSq 0.9756884    CV-RSq 0.950508
> printh(summary(a0))
=== summary(a0)
Call: earth(formula=Volume~., data=trees, trace=0.5, nfold=3)

             coefficients
(Intercept)    27.2458996
h(Girth-14)     6.1766918
h(14-Girth)    -3.2662277
h(Height-72)    0.4912072

Selected 4 of 6 terms, and 2 of 2 predictors 
Importance: Girth, Height
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 10.60632    RSS 197.0722    GRSq 0.962013    RSq 0.9756884    CV-RSq 0.950508

Cross validation: nterms 4.00 sd 0.00  nvars 2.00 sd 0.00

         CV-RSq         sd  MaxErr       sd
Volume 0.950508 0.02359896 8.13921 8.473541
> print.stripped.earth.model(a0, "a0")
print.stripped.earth.model(a0)
$dirs
              Girth Height
(Intercept)       0      0
h(Girth-14)       1      0
h(14-Girth)      -1      0
h(Height-72)      0      1
h(72-Height)      0     -1
h(Girth-12.9)     1      0

$cuts
              Girth Height
(Intercept)     0.0      0
h(Girth-14)    14.0      0
h(14-Girth)    14.0      0
h(Height-72)    0.0     72
h(72-Height)    0.0     72
h(Girth-12.9)  12.9      0

$selected.terms
[1] 1 2 3 4

$prune.terms
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    0    0    0    0    0
[2,]    1    2    0    0    0    0
[3,]    1    2    3    0    0    0
[4,]    1    2    3    4    0    0
[5,]    1    2    3    4    6    0
[6,]    1    2    3    4    5    6

$rss
[1] 197.0722

$rsq
[1] 0.9756884

$gcv
[1] 10.60632

$grsq
[1] 0.962013

$rss.per.response
[1] 197.0722

$rsq.per.response
[1] 0.9756884

$gcv.per.response
[1] 10.60632

$grsq.per.response
[1] 0.962013

$rss.per.subset
[1] 8106.0839 1147.4599  313.4085  197.0722  189.2489  185.6530

$gcv.per.subset
[1] 279.20956  45.37150  14.37228  10.60632  12.12131  14.38811

$coefficients
                 Volume
(Intercept)  27.2458996
h(Girth-14)   6.1766918
h(14-Girth)  -3.2662277
h(Height-72)  0.4912072

$penalty
[1] 2

$namesx.org
[1] "Girth"  "Height"

$namesx
[1] "Girth"  "Height"

$terms
Volume ~ Girth + Height
attr(,"variables")
list(Volume, Girth, Height)
attr(,"factors")
       Girth Height
Volume     0      0
Girth      1      0
Height     0      1
attr(,"term.labels")
[1] "Girth"  "Height"
attr(,"order")
[1] 1 1
attr(,"intercept")
[1] 1
attr(,"response")
[1] 1
attr(,".Environment")
<environment: R_GlobalEnv>
attr(,"predvars")
list(Volume, Girth, Height)
attr(,"dataClasses")
   Volume     Girth    Height 
"numeric" "numeric" "numeric" 

$call
earth(formula = Volume ~ ., data = trees, trace = 0.5, nfold = 3)

$cv.rsq.tab
          Volume      mean
fold 1 0.9525513 0.9525513
fold 2 0.9259537 0.9259537
fold 3 0.9730188 0.9730188
mean   0.9505079 0.9505079

$cv.maxerr.tab
          Volume       max
fold 1 -6.340224 -6.340224
fold 2 -6.726922 -6.726922
fold 3  8.139210  8.139210
max     8.139210  8.139210

$cv.groups
 [1] 3 1 2 3 1 2 3 3 2 3 2 3 1 3 2 3 2 2 1 1 1 1 2 2 1 1 2 3 1 1 3

$cv.nterms
fold 1 fold 2 fold 3   mean 
     4      4      4      4 

$cv.nvars
fold 1 fold 2 fold 3   mean 
     2      2      2      2 

$cv.list
$cv.list$cv1
Selected 4 of 5 terms, and 2 of 2 predictors 
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 18.27323    RSS 154.4088    GRSq 0.9420522    RSq 0.972872

$cv.list$cv2
Selected 4 of 5 terms, and 2 of 2 predictors 
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 11.32282    RSS 105.6797    GRSq 0.9673022    RSq 0.9839781

$cv.list$cv3
Selected 4 of 5 terms, and 2 of 2 predictors 
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 17.92712    RSS 167.3198    GRSq 0.910795    RSq 0.9562895


attr(,"class")
[1] "earth"
-------------------------------------------------------------------------------

> 
> cat("a0a: trees with matrix interface\n\n")
a0a: trees with matrix interface

> 
> set.seed(23)
> a0a <- earth(trees[,-3], trees[,3], trace=0.5, nfold=3)
CV fold  1: CV-RSq 0.953  ntrain-nz 20 ntest-nz 11 
CV fold  2: CV-RSq 0.926  ntrain-nz 21 ntest-nz 10 
CV fold  3: CV-RSq 0.973  ntrain-nz 21 ntest-nz 10 
CV all:     CV-RSq 0.951  ntrain-nz 31 

> stopifnot(!identical(a0$cv.rsq.tab,a0a$cv.rsq.tab))
> printh(a0a)
=== a0a
Selected 4 of 6 terms, and 2 of 2 predictors 
Importance: Girth, Height
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 10.60632    RSS 197.0722    GRSq 0.962013    RSq 0.9756884    CV-RSq 0.950508
> printh(summary(a0a))
=== summary(a0a)
Call: earth(x=trees[, -3], y=trees[, 3], trace=0.5, nfold=3)

             coefficients
(Intercept)    27.2458996
h(Girth-14)     6.1766918
h(14-Girth)    -3.2662277
h(Height-72)    0.4912072

Selected 4 of 6 terms, and 2 of 2 predictors 
Importance: Girth, Height
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 10.60632    RSS 197.0722    GRSq 0.962013    RSq 0.9756884    CV-RSq 0.950508

Cross validation: nterms 4.00 sd 0.00  nvars 2.00 sd 0.00

            CV-RSq         sd  MaxErr       sd
trees[,3] 0.950508 0.02359896 8.13921 8.473541
> print.stripped.earth.model(a0a, "a0a")
print.stripped.earth.model(a0a)
$dirs
              Girth Height
(Intercept)       0      0
h(Girth-14)       1      0
h(14-Girth)      -1      0
h(Height-72)      0      1
h(72-Height)      0     -1
h(Girth-12.9)     1      0

$cuts
              Girth Height
(Intercept)     0.0      0
h(Girth-14)    14.0      0
h(14-Girth)    14.0      0
h(Height-72)    0.0     72
h(72-Height)    0.0     72
h(Girth-12.9)  12.9      0

$selected.terms
[1] 1 2 3 4

$prune.terms
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    0    0    0    0    0
[2,]    1    2    0    0    0    0
[3,]    1    2    3    0    0    0
[4,]    1    2    3    4    0    0
[5,]    1    2    3    4    6    0
[6,]    1    2    3    4    5    6

$rss
[1] 197.0722

$rsq
[1] 0.9756884

$gcv
[1] 10.60632

$grsq
[1] 0.962013

$rss.per.response
[1] 197.0722

$rsq.per.response
[1] 0.9756884

$gcv.per.response
[1] 10.60632

$grsq.per.response
[1] 0.962013

$rss.per.subset
[1] 8106.0839 1147.4599  313.4085  197.0722  189.2489  185.6530

$gcv.per.subset
[1] 279.20956  45.37150  14.37228  10.60632  12.12131  14.38811

$coefficients
              trees[,3]
(Intercept)  27.2458996
h(Girth-14)   6.1766918
h(14-Girth)  -3.2662277
h(Height-72)  0.4912072

$penalty
[1] 2

$call
earth(x = trees[, -3], y = trees[, 3], trace = 0.5, nfold = 3)

$namesx.org
[1] "Girth"  "Height"

$namesx
[1] "Girth"  "Height"

$cv.list
$cv.list$cv1
Selected 4 of 5 terms, and 2 of 2 predictors 
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 18.27323    RSS 154.4088    GRSq 0.9420522    RSq 0.972872

$cv.list$cv2
Selected 4 of 5 terms, and 2 of 2 predictors 
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 11.32282    RSS 105.6797    GRSq 0.9673022    RSq 0.9839781

$cv.list$cv3
Selected 4 of 5 terms, and 2 of 2 predictors 
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 17.92712    RSS 167.3198    GRSq 0.910795    RSq 0.9562895


$cv.nterms
fold 1 fold 2 fold 3   mean 
     4      4      4      4 

$cv.nvars
fold 1 fold 2 fold 3   mean 
     2      2      2      2 

$cv.rsq.tab
       trees[,3]      mean
fold 1 0.9525513 0.9525513
fold 2 0.9259537 0.9259537
fold 3 0.9730188 0.9730188
mean   0.9505079 0.9505079

$cv.maxerr.tab
       trees[,3]       max
fold 1 -6.340224 -6.340224
fold 2 -6.726922 -6.726922
fold 3  8.139210  8.139210
max     8.139210  8.139210

$cv.groups
 [1] 3 1 2 3 1 2 3 3 2 3 2 3 1 3 2 3 2 2 1 1 1 1 2 2 1 1 2 3 1 1 3

attr(,"class")
[1] "earth"
-------------------------------------------------------------------------------

> 
> cat("a1: trees with trace enabled\n\n")
a1: trees with trace enabled

> 
> set.seed(1)
> a1 <- earth(Volume ~ ., data = trees, trace=1, nfold=3)
x is a 31 by 2 matrix: 1=Girth, 2=Height
y is a 31 by 1 matrix: 1=Volume
Forward pass term 1, 2, 4, 6, 8
Reached delta RSq threshold (DeltaRSq 0.000280038 < 0.001)
After forward pass GRSq 0.9372 RSq 0.9774
Prune method "backward" penalty 2 nprune 6: selected 4 of 6 terms, and 2 of 2 predictors
After backward pass GRSq 0.962 RSq 0.9757 

CV fold  1 --------------------------------------------------------------------
x is a 20 by 2 matrix: 1=Girth, 2=Height
y is a 20 by 1 matrix: 1=Volume
Forward pass term 1, 2, 4, 6
Reached delta RSq threshold (DeltaRSq 0 < 0.001)
After forward pass GRSq 0.8935 RSq 0.9761
Prune method "backward" penalty 2 nprune 5: selected 4 of 5 terms, and 2 of 2 predictors
After backward pass GRSq 0.941 RSq 0.9724 
CV fold  1: CV-RSq 0.958  ntrain-nz 20 ntest-nz 11 

CV fold  2 --------------------------------------------------------------------
x is a 21 by 2 matrix: 1=Girth, 2=Height
y is a 21 by 1 matrix: 1=Volume
Forward pass term 1, 2, 4, 6
Reached delta RSq threshold (DeltaRSq 0.00011907 < 0.001)
After forward pass GRSq 0.9345 RSq 0.9836
Prune method "backward" penalty 2 nprune 5: selected 4 of 5 terms, and 2 of 2 predictors
After backward pass GRSq 0.9627 RSq 0.9817 
CV fold  2: CV-RSq 0.940  ntrain-nz 21 ntest-nz 10 

CV fold  3 --------------------------------------------------------------------
x is a 21 by 2 matrix: 1=Girth, 2=Height
y is a 21 by 1 matrix: 1=Volume
Forward pass term 1, 2, 4, 6
Reached delta RSq threshold (DeltaRSq 2.00053e-005 < 0.001)
After forward pass GRSq 0.8833 RSq 0.9708
Prune method "backward" penalty 2 nprune 5: selected 4 of 5 terms, and 2 of 2 predictors
After backward pass GRSq 0.935 RSq 0.9682 
CV fold  3: CV-RSq 0.989  ntrain-nz 21 ntest-nz 10 

CV all:     CV-RSq 0.962  ntrain-nz 31 

> stopifnot(!identical(a0$cv.rsq.tab,a1$cv.rsq.tab))
> printh(a1)
=== a1
Selected 4 of 6 terms, and 2 of 2 predictors 
Importance: Girth, Height
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 10.60632    RSS 197.0722    GRSq 0.962013    RSq 0.9756884    CV-RSq 0.9624252
> printh(summary(a1))
=== summary(a1)
Call: earth(formula=Volume~., data=trees, trace=1, nfold=3)

             coefficients
(Intercept)    27.2458996
h(Girth-14)     6.1766918
h(14-Girth)    -3.2662277
h(Height-72)    0.4912072

Selected 4 of 6 terms, and 2 of 2 predictors 
Importance: Girth, Height
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 10.60632    RSS 197.0722    GRSq 0.962013    RSq 0.9756884    CV-RSq 0.9624252

Cross validation: nterms 4.00 sd 0.00  nvars 2.00 sd 0.00

          CV-RSq         sd   MaxErr       sd
Volume 0.9624252 0.02471958 -9.12487 7.538179
> 
> # test correct operation of update
> 
> cat("a2 <- update(a0) # should do cv\n")
a2 <- update(a0) # should do cv
> set.seed(2)
> a2 <- update(a0)
CV fold  1: CV-RSq 0.935  ntrain-nz 20 ntest-nz 11 
CV fold  2: CV-RSq 0.978  ntrain-nz 21 ntest-nz 10 
CV fold  3: CV-RSq 0.939  ntrain-nz 21 ntest-nz 10 
CV all:     CV-RSq 0.951  ntrain-nz 31 

> cat("a3 <- update(a0) # should do cv\n")
a3 <- update(a0) # should do cv
> set.seed(3)
> a3 <- update(a0, formula=Volume~.-Height)
CV fold  1: CV-RSq 0.942  ntrain-nz 20 ntest-nz 11 
CV fold  2: CV-RSq 0.866  ntrain-nz 21 ntest-nz 10 
CV fold  3: CV-RSq 0.968  ntrain-nz 21 ntest-nz 10 
CV all:     CV-RSq 0.925  ntrain-nz 31 

> printh(a3$cv.rsq.tab)
=== a3$cv.rsq.tab
          Volume      mean
fold 1 0.9419703 0.9419703
fold 2 0.8661310 0.8661310
fold 3 0.9682819 0.9682819
mean   0.9254611 0.9254611
> printh(a3)
=== a3
Selected 3 of 3 terms, and 1 of 1 predictors 
Importance: Girth
Number of terms at each degree of interaction: 1 2 (additive model)
GCV 14.25598    RSS 310.8724    GRSq 0.9489416    RSq 0.9616495    CV-RSq 0.925461
> printh(summary(a3))
=== summary(a3)
Call: earth(formula=Volume~Girth, data=trees, trace=0.5, nfold=3)

              coefficients
(Intercept)      28.288188
h(Girth-13.7)     6.527497
h(13.7-Girth)    -3.388061

Selected 3 of 3 terms, and 1 of 1 predictors 
Importance: Girth
Number of terms at each degree of interaction: 1 2 (additive model)
GCV 14.25598    RSS 310.8724    GRSq 0.9489416    RSq 0.9616495    CV-RSq 0.925461

Cross validation: nterms 3.00 sd 0.00  nvars 1.00 sd 0.00

         CV-RSq        sd   MaxErr       sd
Volume 0.925461 0.0530388 10.10898 9.241489
> cat("a4 <- update(a0, nfold=0, trace=.5)  # should not do cv\n")
a4 <- update(a0, nfold=0, trace=.5)  # should not do cv
> set.seed(4)
> a4 <- update(a0, nfold=0, trace=.5)
> cat("a5 <- update(a4, trace=.5)           # should not do cv\n")
a5 <- update(a4, trace=.5)           # should not do cv
> set.seed(5)
> a5 <- update(a4)
> cat("a5a <- update(a4, nfold=2, trace=.5) # should do cv\n")
a5a <- update(a4, nfold=2, trace=.5) # should do cv
> set.seed(2)
> a5a <- update(a4, nfold=2, trace=.5)
CV fold  1: CV-RSq 0.929  ntrain-nz 15 ntest-nz 16 
CV fold  2: CV-RSq 0.928  ntrain-nz 16 ntest-nz 15 
CV all:     CV-RSq 0.928  ntrain-nz 31 

> 
> cat("a6: titanic data, one logical response\n\n")
a6: titanic data, one logical response

> survived. <- as.logical(etitanic$survived)
> set.seed(6)
> a6 <- earth(survived. ~ ., data=etitanic[,-2], degree=2, glm=list(family="binomial"), trace=0.5, nfold=3)
CV fold  1: CV-RSq 0.416  ntrain-nz 284 ntest-nz 143 
CV fold  2: CV-RSq 0.416  ntrain-nz 285 ntest-nz 142 
CV fold  3: CV-RSq 0.424  ntrain-nz 285 ntest-nz 142 
CV all:     CV-RSq 0.418  ntrain-nz 427 

> # TODO extend this list
> printh(a6$cv.nterms)
=== a6$cv.nterms
  fold 1   fold 2   fold 3     mean 
9.000000 9.000000 8.000000 8.666667 
> printh(a6$cv.nvars)
=== a6$cv.nvars
fold 1 fold 2 fold 3   mean 
     6      6      6      6 
> printh(a6$cv.rsq.tab)
=== a6$cv.rsq.tab
       survived.      mean
fold 1 0.4155091 0.4155091
fold 2 0.4157867 0.4157867
fold 3 0.4236844 0.4236844
mean   0.4183267 0.4183267
> printh(a6$cv.maxerr.tab)
=== a6$cv.maxerr.tab
        survived.        max
fold 1 -0.9761973 -0.9761973
fold 2 -0.9424787 -0.9424787
fold 3  0.9817507  0.9817507
max     0.9817507  0.9817507
> printh(a6$cv.deviance.tab)
=== a6$cv.deviance.tab
       survived.      mean
fold 1 0.9040625 0.9040625
fold 2 0.8793633 0.8793633
fold 3 0.8793854 0.8793854
mean   0.8876037 0.8876037
> printh(a6$cv.auc.tab)
=== a6$cv.auc.tab
       survived.      mean
fold 1 0.8601748 0.8601748
fold 2 0.8599574 0.8599574
fold 3 0.8520954 0.8520954
mean   0.8574092 0.8574092
> printh(a6$cv.calib.int.tab)
=== a6$cv.calib.int.tab
         survived.        mean
fold 1 -0.11567593 -0.11567593
fold 2 -0.21951719 -0.21951719
fold 3  0.19967286  0.19967286
mean   -0.04517342 -0.04517342
> printh(a6$cv.calib.slope.tab)
=== a6$cv.calib.slope.tab
       survived.      mean
fold 1 0.8910003 0.8910003
fold 2 0.9052154 0.9052154
fold 3 0.9827216 0.9827216
mean   0.9263124 0.9263124
> printh(a6$cv.auc.tab)
=== a6$cv.auc.tab
       survived.      mean
fold 1 0.8601748 0.8601748
fold 2 0.8599574 0.8599574
fold 3 0.8520954 0.8520954
mean   0.8574092 0.8574092
> printh(a6$cv.cor.tab)
=== a6$cv.cor.tabNULL
> printh(a6$cv.groups)
=== a6$cv.groups
   [1] 1 2 3 1 2 3 3 1 1 1 1 2 3 1 3 3 2 2 2 2 2 1 3 1 1 2 3 3 1 3 1 2 2 2 3 3 1 3 1 2 2 1 3 3 1 3 1 2 2 3 2 3 3 1 3 3 1 1 1 1 1 1 1 2 3 3 2 3 1 2 1 3 3 2 2 3 1 1 2 2 2 3 2 3 1 1 3 1 1 3 3 2 3 2 2 2 1
  [98] 3 2 2 3 2 1 1 3 3 1 3 2 1 2 3 3 3 3 3 1 1 2 3 2 3 3 2 3 2 2 2 3 2 3 3 1 3 3 1 2 3 3 1 2 2 3 1 2 2 2 2 2 2 3 3 2 3 1 3 1 2 1 1 3 3 2 1 3 3 1 1 3 1 2 1 2 3 3 2 2 2 3 1 2 2 1 1 3 2 1 2 1 2 1 1 2 1
 [195] 2 2 1 1 2 2 1 3 1 1 2 1 2 3 2 1 3 3 2 1 1 2 3 3 2 2 3 2 1 3 1 2 3 2 3 2 3 1 2 3 2 1 2 3 1 3 3 3 1 3 1 1 3 1 1 2 1 3 1 3 3 3 1 3 1 1 2 3 2 2 2 3 1 1 2 2 2 1 3 3 3 2 1 2 2 1 2 1 3 2 3 2 3 2 3 3 3
 [292] 1 3 2 2 2 3 2 2 2 3 1 2 2 2 1 1 1 3 2 3 2 3 2 1 2 2 3 1 1 1 2 1 3 1 3 2 3 2 1 2 3 1 3 2 1 3 2 3 2 1 1 2 3 1 3 3 2 1 2 3 2 1 2 1 2 3 1 3 1 3 1 3 2 3 1 2 1 2 2 1 2 2 3 3 1 3 3 1 3 1 3 1 1 2 3 1 1
 [389] 1 1 2 1 1 3 1 3 1 2 3 2 2 1 1 1 1 2 2 2 3 2 3 2 2 1 3 3 2 1 2 1 1 2 3 3 1 2 2 2 3 3 1 1 1 1 3 2 1 3 1 2 3 3 2 2 2 1 3 2 2 1 1 1 1 2 1 2 1 3 3 2 1 2 3 3 3 1 2 2 1 1 1 3 2 2 3 2 2 3 3 3 1 3 3 3 3
 [486] 3 2 3 3 2 2 3 1 3 2 2 1 1 3 3 2 2 1 2 3 2 3 2 1 3 1 2 1 2 3 2 1 1 2 1 1 1 3 2 2 2 2 3 1 3 1 2 2 1 3 2 1 1 2 2 1 2 2 3 2 2 3 2 2 3 2 1 1 2 1 3 2 3 1 3 3 2 2 2 3 2 2 1 1 2 3 3 1 3 3 3 1 1 3 3 3 1
 [583] 2 3 1 2 1 1 3 3 3 1 2 1 3 3 1 3 3 3 2 2 1 2 3 1 2 3 3 1 1 3 1 1 3 2 1 3 3 2 1 3 1 2 1 1 2 1 3 3 1 3 3 3 1 3 1 3 2 3 2 1 3 2 2 3 1 2 2 3 2 2 1 3 2 1 1 1 3 1 1 2 2 2 2 1 2 1 3 1 2 3 1 1 3 1 1 3 1
 [680] 1 3 3 1 1 1 3 1 2 2 3 3 3 3 1 3 1 2 1 2 3 2 1 3 2 1 1 2 3 2 2 2 3 3 3 1 2 2 3 2 2 1 2 2 1 2 2 3 1 1 3 2 3 1 1 1 3 1 3 3 3 2 1 3 2 3 2 2 1 2 2 3 2 1 2 3 2 1 3 3 3 1 3 1 1 3 2 2 1 3 3 3 3 1 2 2 1
 [777] 3 3 3 1 2 3 2 2 1 1 2 3 2 2 2 3 3 1 1 1 1 3 2 3 3 1 3 1 3 1 2 1 2 2 3 3 2 2 1 2 2 2 2 3 1 3 1 2 3 3 1 3 3 3 1 1 1 2 1 2 2 3 2 1 2 2 2 2 1 2 3 3 2 1 1 2 1 2 3 1 3 1 2 3 3 1 2 2 2 3 1 2 1 2 3 1 3
 [874] 1 1 3 2 3 3 3 1 3 1 1 2 2 2 2 1 1 1 3 3 1 3 1 1 1 3 2 1 3 3 1 3 1 2 2 2 2 2 3 1 1 2 2 3 1 1 2 2 3 2 2 1 3 1 3 3 2 1 3 1 1 2 1 3 2 1 2 3 2 2 2 1 1 3 1 3 3 2 3 2 2 2 2 3 2 3 1 3 1 2 1 2 1 2 1 3 3
 [971] 2 1 1 3 3 3 1 2 1 3 2 2 2 1 2 3 2 3 3 1 2 2 3 2 3 3 1 1 2 1 3 1 2 1 1 3 2 1 1 3 1 3 3 1 3 2 2 2 2 2 2 2 3 1 2 2 2 3 1 1 3 3 3 3 1 1 3 2 1 1 1 2 2 1 2 1
> printh(a6$cv.groups)
=== a6$cv.groups
   [1] 1 2 3 1 2 3 3 1 1 1 1 2 3 1 3 3 2 2 2 2 2 1 3 1 1 2 3 3 1 3 1 2 2 2 3 3 1 3 1 2 2 1 3 3 1 3 1 2 2 3 2 3 3 1 3 3 1 1 1 1 1 1 1 2 3 3 2 3 1 2 1 3 3 2 2 3 1 1 2 2 2 3 2 3 1 1 3 1 1 3 3 2 3 2 2 2 1
  [98] 3 2 2 3 2 1 1 3 3 1 3 2 1 2 3 3 3 3 3 1 1 2 3 2 3 3 2 3 2 2 2 3 2 3 3 1 3 3 1 2 3 3 1 2 2 3 1 2 2 2 2 2 2 3 3 2 3 1 3 1 2 1 1 3 3 2 1 3 3 1 1 3 1 2 1 2 3 3 2 2 2 3 1 2 2 1 1 3 2 1 2 1 2 1 1 2 1
 [195] 2 2 1 1 2 2 1 3 1 1 2 1 2 3 2 1 3 3 2 1 1 2 3 3 2 2 3 2 1 3 1 2 3 2 3 2 3 1 2 3 2 1 2 3 1 3 3 3 1 3 1 1 3 1 1 2 1 3 1 3 3 3 1 3 1 1 2 3 2 2 2 3 1 1 2 2 2 1 3 3 3 2 1 2 2 1 2 1 3 2 3 2 3 2 3 3 3
 [292] 1 3 2 2 2 3 2 2 2 3 1 2 2 2 1 1 1 3 2 3 2 3 2 1 2 2 3 1 1 1 2 1 3 1 3 2 3 2 1 2 3 1 3 2 1 3 2 3 2 1 1 2 3 1 3 3 2 1 2 3 2 1 2 1 2 3 1 3 1 3 1 3 2 3 1 2 1 2 2 1 2 2 3 3 1 3 3 1 3 1 3 1 1 2 3 1 1
 [389] 1 1 2 1 1 3 1 3 1 2 3 2 2 1 1 1 1 2 2 2 3 2 3 2 2 1 3 3 2 1 2 1 1 2 3 3 1 2 2 2 3 3 1 1 1 1 3 2 1 3 1 2 3 3 2 2 2 1 3 2 2 1 1 1 1 2 1 2 1 3 3 2 1 2 3 3 3 1 2 2 1 1 1 3 2 2 3 2 2 3 3 3 1 3 3 3 3
 [486] 3 2 3 3 2 2 3 1 3 2 2 1 1 3 3 2 2 1 2 3 2 3 2 1 3 1 2 1 2 3 2 1 1 2 1 1 1 3 2 2 2 2 3 1 3 1 2 2 1 3 2 1 1 2 2 1 2 2 3 2 2 3 2 2 3 2 1 1 2 1 3 2 3 1 3 3 2 2 2 3 2 2 1 1 2 3 3 1 3 3 3 1 1 3 3 3 1
 [583] 2 3 1 2 1 1 3 3 3 1 2 1 3 3 1 3 3 3 2 2 1 2 3 1 2 3 3 1 1 3 1 1 3 2 1 3 3 2 1 3 1 2 1 1 2 1 3 3 1 3 3 3 1 3 1 3 2 3 2 1 3 2 2 3 1 2 2 3 2 2 1 3 2 1 1 1 3 1 1 2 2 2 2 1 2 1 3 1 2 3 1 1 3 1 1 3 1
 [680] 1 3 3 1 1 1 3 1 2 2 3 3 3 3 1 3 1 2 1 2 3 2 1 3 2 1 1 2 3 2 2 2 3 3 3 1 2 2 3 2 2 1 2 2 1 2 2 3 1 1 3 2 3 1 1 1 3 1 3 3 3 2 1 3 2 3 2 2 1 2 2 3 2 1 2 3 2 1 3 3 3 1 3 1 1 3 2 2 1 3 3 3 3 1 2 2 1
 [777] 3 3 3 1 2 3 2 2 1 1 2 3 2 2 2 3 3 1 1 1 1 3 2 3 3 1 3 1 3 1 2 1 2 2 3 3 2 2 1 2 2 2 2 3 1 3 1 2 3 3 1 3 3 3 1 1 1 2 1 2 2 3 2 1 2 2 2 2 1 2 3 3 2 1 1 2 1 2 3 1 3 1 2 3 3 1 2 2 2 3 1 2 1 2 3 1 3
 [874] 1 1 3 2 3 3 3 1 3 1 1 2 2 2 2 1 1 1 3 3 1 3 1 1 1 3 2 1 3 3 1 3 1 2 2 2 2 2 3 1 1 2 2 3 1 1 2 2 3 2 2 1 3 1 3 3 2 1 3 1 1 2 1 3 2 1 2 3 2 2 2 1 1 3 1 3 3 2 3 2 2 2 2 3 2 3 1 3 1 2 1 2 1 2 1 3 3
 [971] 2 1 1 3 3 3 1 2 1 3 2 2 2 1 2 3 2 3 3 1 2 2 3 2 3 3 1 1 2 1 3 1 2 1 1 3 2 1 1 3 1 3 3 1 3 2 2 2 2 2 2 2 3 1 2 2 2 3 1 1 3 3 3 3 1 1 3 2 1 1 1 2 2 1 2 1
> printh(a6$cv.list.)
=== a6$cv.list.NULL
> printh(a6)
=== a6
Earth selected 9 of 16 terms, and 6 of 6 predictors 
Importance: sexmale, pclass3rd, pclass2nd, age, sibsp, parch
Number of terms at each degree of interaction: 1 3 5
Earth GCV 0.1398544    RSS 140.4728    GRSq 0.422183    RSq 0.4440888    CV-RSq 0.4183267

GLM null.deviance 1414.620 (1045 dof)   deviance 879.625 (1037 dof)   iters 5
> printh(summary(a6))
=== summary(a6)
Call: earth(formula=survived.~., data=etitanic[, -2], glm=list(family="binomial"), 
      trace=0.5, nfold=3, degree=2)

GLM coefficients
                        survived.
(Intercept)             2.2790214
pclass3rd              -5.6531684
sexmale                -3.6196553
h(64-age)               0.0286030
pclass2nd * sexmale    -0.7266366
pclass2nd * h(1-parch) -1.3748420
pclass3rd * sexmale     1.8084471
pclass3rd * h(4-sibsp)  0.6223609
sexmale * h(16-age)     0.1701548

Earth selected 9 of 16 terms, and 6 of 6 predictors 
Importance: sexmale, pclass3rd, pclass2nd, age, sibsp, parch
Number of terms at each degree of interaction: 1 3 5
Earth GCV 0.1398544    RSS 140.4728    GRSq 0.422183    RSq 0.4440888    CV-RSq 0.4183267

GLM null.deviance 1414.620 (1045 dof)   deviance 879.625 (1037 dof)   iters 5

Cross validation: nterms 8.67 sd 0.58  nvars 6.00 sd 0.00

             CV-RSq          sd   MeanDev         sd    CalibInt        sd CalibSlope         sd       AUC          sd    MaxErr       sd
survived. 0.4183267 0.004641934 0.8876037 0.01425373 -0.04517342 0.2183072  0.9263124 0.04936612 0.8574092 0.004603173 0.9817507 1.120815
> # expect a note: plotmo cannot use factors as axes for degree2 plots...
> plotmo(a6)

 grid:    pclass    sex age sibsp parch
             1st female  28     0     0

Note: plotmo cannot use factors as axes for degree2 plots,
      so skipping degree2 plots for: pclass, sex
> printh(a6$cv.list[[2]])
=== a6$cv.list[[2]]
Earth selected 9 of 16 terms, and 6 of 6 predictors 
Number of terms at each degree of interaction: 1 2 6
Earth GCV 0.1427513    RSS 92.45144    GRSq 0.4131453    RSq 0.4467688

GLM null.deviance 934.5004 (688 dof)   deviance 581.8674 (680 dof)   iters 5
> printh(summary(a6$cv.list[[2]]))
=== summary(a6$cv.list[[2]])
Call: NULL

GLM coefficients
                         survived.
(Intercept)             2.78638204
pclass3rd              -2.53116076
sexmale                -3.10000304
pclass2nd * sexmale    -1.99620819
pclass3rd * sexmale     1.34197054
pclass3rd * h(sibsp-1) -0.69298020
pclass3rd * h(parch-1) -0.42016344
sexmale * h(14-age)     0.32446563
sexmale * h(age-32)    -0.03882517

Earth selected 9 of 16 terms, and 6 of 6 predictors 
Number of terms at each degree of interaction: 1 2 6
Earth GCV 0.1427513    RSS 92.45144    GRSq 0.4131453    RSq 0.4467688

GLM null.deviance 934.5004 (688 dof)   deviance 581.8674 (680 dof)   iters 5
> 
> cat("a6a: stratify=FALSE\n\n")
a6a: stratify=FALSE

> set.seed(6)
> a6a <- earth(survived. ~ ., data=etitanic[,-2], degree=2, glm=list(family="binomial"), trace=0.5, nfold=3, stratify=FALSE)
CV fold  1: CV-RSq 0.436  ntrain-nz 278 ntest-nz 149 
CV fold  2: CV-RSq 0.403  ntrain-nz 293 ntest-nz 134 
CV fold  3: CV-RSq 0.400  ntrain-nz 283 ntest-nz 144 
CV all:     CV-RSq 0.413  ntrain-nz 427 

> printh(a6a$cv.rsq.tab)
=== a6a$cv.rsq.tab
       survived.      mean
fold 1 0.4355590 0.4355590
fold 2 0.4033428 0.4033428
fold 3 0.4000398 0.4000398
mean   0.4129805 0.4129805
> printh(a6a)
=== a6a
Earth selected 9 of 16 terms, and 6 of 6 predictors 
Importance: sexmale, pclass3rd, pclass2nd, age, sibsp, parch
Number of terms at each degree of interaction: 1 3 5
Earth GCV 0.1398544    RSS 140.4728    GRSq 0.422183    RSq 0.4440888    CV-RSq 0.4129805

GLM null.deviance 1414.620 (1045 dof)   deviance 879.625 (1037 dof)   iters 5
> printh(summary(a6a))
=== summary(a6a)
Call: earth(formula=survived.~., data=etitanic[, -2], glm=list(family="binomial"), 
      trace=0.5, nfold=3, stratify=FALSE, degree=2)

GLM coefficients
                        survived.
(Intercept)             2.2790214
pclass3rd              -5.6531684
sexmale                -3.6196553
h(64-age)               0.0286030
pclass2nd * sexmale    -0.7266366
pclass2nd * h(1-parch) -1.3748420
pclass3rd * sexmale     1.8084471
pclass3rd * h(4-sibsp)  0.6223609
sexmale * h(16-age)     0.1701548

Earth selected 9 of 16 terms, and 6 of 6 predictors 
Importance: sexmale, pclass3rd, pclass2nd, age, sibsp, parch
Number of terms at each degree of interaction: 1 3 5
Earth GCV 0.1398544    RSS 140.4728    GRSq 0.422183    RSq 0.4440888    CV-RSq 0.4129805

GLM null.deviance 1414.620 (1045 dof)   deviance 879.625 (1037 dof)   iters 5

Cross validation: nterms 8.00 sd 1.00  nvars 5.67 sd 0.58

             CV-RSq         sd   MeanDev        sd    CalibInt       sd CalibSlope         sd       AUC         sd    MaxErr       sd
survived. 0.4129805 0.01962315 0.9007584 0.0290033 -0.03681553 0.255376  0.9154234 0.02202553 0.8526014 0.01372947 0.9829878 1.115646
> 
> cat("a7: titanic data, multiple responses (i.e. 3 level factor)\n\n")
a7: titanic data, multiple responses (i.e. 3 level factor)

> set.seed(3)
> # keepxy is needed for summary and plotmo of submodels
> a7 <- earth(pclass ~ ., data=etitanic, degree=2, glm=list(family="binomial"), trace=0.5, nfold=10, keepxy=TRUE)
CV fold  1: CV-RSq 0.238  Per response CV-RSq 0.387  0.003  0.324  
                          ntrain-nz 255 234 450 ntest-nz  29  27  51 
CV fold  2: CV-RSq 0.197  Per response CV-RSq 0.283  0.040  0.267  
                          ntrain-nz 255 235 451 ntest-nz  29  26  50 
CV fold  3: CV-RSq 0.225  Per response CV-RSq 0.306  0.054  0.315  
                          ntrain-nz 255 235 451 ntest-nz  29  26  50 
CV fold  4: CV-RSq 0.171  Per response CV-RSq 0.171  0.047  0.294  
                          ntrain-nz 255 235 451 ntest-nz  29  26  50 
CV fold  5: CV-RSq 0.191  Per response CV-RSq 0.256  0.016  0.302  
                          ntrain-nz 256 235 451 ntest-nz  28  26  50 
CV fold  6: CV-RSq 0.200  Per response CV-RSq 0.358  0.024  0.218  
                          ntrain-nz 256 235 451 ntest-nz  28  26  50 
CV fold  7: CV-RSq 0.070  Per response CV-RSq 0.082  0.016  0.110  
                          ntrain-nz 256 235 451 ntest-nz  28  26  50 
CV fold  8: CV-RSq 0.190  Per response CV-RSq 0.362  -0.029 0.235  
                          ntrain-nz 256 235 451 ntest-nz  28  26  50 
CV fold  9: CV-RSq 0.121  Per response CV-RSq 0.232  -0.052 0.183  
                          ntrain-nz 256 235 451 ntest-nz  28  26  50 
CV fold 10: CV-RSq 0.154  Per response CV-RSq 0.231  0.028  0.203  
                          ntrain-nz 256 235 451 ntest-nz  28  26  50 
CV all:     CV-RSq 0.176  Per response CV-RSq 0.267  0.015  0.245  
                          ntrain-nz 284 261 501 

> printh(a7$cv.nterms)
=== a7$cv.nterms
fold  1 fold  2 fold  3 fold  4 fold  5 fold  6 fold  7 fold  8 fold  9 fold 10    mean 
      9      13       9      10      10      11      10       9      10       9      10 
> printh(a7$cv.nvars)
=== a7$cv.nvars
fold  1 fold  2 fold  3 fold  4 fold  5 fold  6 fold  7 fold  8 fold  9 fold 10    mean 
      5       5       5       5       5       5       5       5       5       5       5 
> printh(a7$cv.rsq.tab)
=== a7$cv.rsq.tab
               1st          2nd       3rd       mean
fold  1 0.38651052  0.002574131 0.3235492 0.23754463
fold  2 0.28250421  0.039927325 0.2672429 0.19655815
fold  3 0.30565769  0.053894720 0.3147730 0.22477514
fold  4 0.17079361  0.046994139 0.2944930 0.17076024
fold  5 0.25617842  0.015770463 0.3022837 0.19141085
fold  6 0.35772344  0.023580543 0.2184016 0.19990186
fold  7 0.08183425  0.016264898 0.1104498 0.06951633
fold  8 0.36180867 -0.028524999 0.2352974 0.18952701
fold  9 0.23191522 -0.051634802 0.1825216 0.12093400
fold 10 0.23146483  0.028146300 0.2028216 0.15414424
mean    0.26663909  0.014699272 0.2451834 0.17550724
> printh(a7$cv.maxerr.tab)
=== a7$cv.maxerr.tab
              1st       2nd        3rd       max
fold  1 0.9338839 0.8792506 -0.8572647 0.9338839
fold  2 0.9672056 0.9069786  0.9042915 0.9672056
fold  3 0.9524979 0.8610439  0.8476686 0.9524979
fold  4 0.9585354 0.9278989  0.8448725 0.9585354
fold  5 0.9229414 0.8197531  0.9487363 0.9487363
fold  6 0.9370042 0.8673994 -0.8718848 0.9370042
fold  7 0.9153709 0.9081057  0.9715114 0.9715114
fold  8 0.9195381 0.8734651  0.9588754 0.9588754
fold  9 0.9551972 0.9201213  0.9651871 0.9651871
fold 10 0.9429795 0.8353368  0.9291246 0.9429795
max     0.9672056 0.9278989  0.9715114 0.9715114
> printh(a7$cv.deviance.tab)
=== a7$cv.deviance.tab
              1st      2nd       3rd      mean
fold  1 0.7504984 1.131740 0.9932574 0.9584986
fold  2 0.8739971 1.080358 1.0799071 1.0114209
fold  3 0.8335160 1.055626 1.0083735 0.9658385
fold  4 1.0319725 1.066969 1.0496101 1.0495172
fold  5 0.9241216 1.112064 1.0506794 1.0289551
fold  6 0.7945166 1.116199 1.1431938 1.0179697
fold  7 1.0721308 1.108664 1.3245420 1.1684455
fold  8 0.7524820 1.139978 1.1183145 1.0035915
fold  9 0.9111505 1.176917 1.1874942 1.0918540
fold 10 0.9140540 1.093446 1.1699606 1.0591536
mean    0.8858440 1.108196 1.1125333 1.0355245
> printh(a7$cv.auc.tab)
=== a7$cv.auc.tab
              1st       2nd       3rd      mean
fold  1 0.8930150 0.5451389 0.8370098 0.7583879
fold  2 0.8328040 0.6377799 0.8067273 0.7591037
fold  3 0.8507260 0.6499513 0.8374545 0.7793773
fold  4 0.7531760 0.6489776 0.8112727 0.7378088
fold  5 0.8167293 0.5803748 0.8362963 0.7444668
fold  6 0.8592575 0.5754438 0.7653704 0.7333572
fold  7 0.7314380 0.5599112 0.7129630 0.6681041
fold  8 0.8876880 0.5212032 0.7825926 0.7304946
fold  9 0.8240132 0.5401874 0.7718519 0.7120175
fold 10 0.8125000 0.5850592 0.7524074 0.7166555
mean    0.8261347 0.5844027 0.7913946 0.7339773
> printh(a7$cv.calib.int.tab)
=== a7$cv.calib.int.tab
                1st         2nd          3rd        mean
fold  1  0.12577302 -0.49652499 -0.043777179 -0.13817638
fold  2  0.17308355 -0.34688152  0.005713529 -0.05602815
fold  3  0.04539776  0.21026828  0.019704495  0.09179018
fold  4 -0.07592327 -0.08906987 -0.150972067 -0.10532174
fold  5 -0.20846628 -0.41388296  0.195528708 -0.14227351
fold  6 -0.06235456 -0.42543904 -0.108432600 -0.19874206
fold  7 -0.48521717 -0.33059125  0.082577205 -0.24441041
fold  8  0.21923904 -0.71869087  0.049925107 -0.14984224
fold  9 -0.08582866 -0.88330422 -0.008579819 -0.32590423
fold 10 -0.01102092 -0.17554605 -0.012476715 -0.06634790
mean    -0.03653175 -0.36696625  0.002921066 -0.13352564
> printh(a7$cv.calib.slope.tab)
=== a7$cv.calib.slope.tab
              1st       2nd       3rd      mean
fold  1 1.3138812 0.4697368 1.2030422 0.9955534
fold  2 0.9916201 0.7997590 0.9523638 0.9145810
fold  3 1.0491514 1.2090036 1.1770268 1.1450606
fold  4 0.6941759 0.9468627 1.2285546 0.9565310
fold  5 0.8769074 0.6650239 1.1251556 0.8890290
fold  6 1.0253730 0.5309002 0.7269833 0.7610855
fold  7 0.5987786 0.6476079 0.5441347 0.5968404
fold  8 1.3812831 0.3418682 0.8755009 0.8662174
fold  9 0.8776028 0.1802239 0.7665103 0.6081123
fold 10 0.9224076 0.8890058 0.8320406 0.8811513
mean    0.9731181 0.6679992 0.9431313 0.8614162
> printh(a7$cv.auc.tab)
=== a7$cv.auc.tab
              1st       2nd       3rd      mean
fold  1 0.8930150 0.5451389 0.8370098 0.7583879
fold  2 0.8328040 0.6377799 0.8067273 0.7591037
fold  3 0.8507260 0.6499513 0.8374545 0.7793773
fold  4 0.7531760 0.6489776 0.8112727 0.7378088
fold  5 0.8167293 0.5803748 0.8362963 0.7444668
fold  6 0.8592575 0.5754438 0.7653704 0.7333572
fold  7 0.7314380 0.5599112 0.7129630 0.6681041
fold  8 0.8876880 0.5212032 0.7825926 0.7304946
fold  9 0.8240132 0.5401874 0.7718519 0.7120175
fold 10 0.8125000 0.5850592 0.7524074 0.7166555
mean    0.8261347 0.5844027 0.7913946 0.7339773
> printh(a7$cv.cor.tab)
=== a7$cv.cor.tabNULL
> printh(a7$cv.groups)
=== a7$cv.groups
   [1]  9  9  3  4  6  8  6  7  5 10  8  8  2  1  3  9  5  9  2  2  6  7  9  4  4  3  5  5  6  8  6  5  6  7  9  6  7  7  6  1  9 10  6  6  7  7  5  8  4  2  5  3  9  2  3  2  5  4  9  7  1  5  5  3
  [65]  6  1  5  7  8  5  6  1  9 10  7  2  4  3 10  1  3  1  2  1  4  1  6  4 10  6  5  5  1  6 10  8  5  1  2  4  2  2  8  4  8  7  7  6  6  6  1  9  8  8  9  9  2 10  7  4  1 10  9 10  9  4  3  1
 [129]  1  9 10  2  2  3 10  7  9  2  5  9  5  6  9 10  8  3  3  5  2  6 10  7  8  9  3  6  3  2  8  2  6  8 10  3  8  5  3  2  4  1 10  6  7  5  3  4  2  2  1  6  5 10  3 10  9  5  9  7  3  5 10 10
 [193]  9  8  4  1  4  2 10  7  5  4  7  2 10  9 10  9  3  4  8  7  3 10  1  4  8  3  4  7 10  9  7  1  4  5  4  7  1  3  8  6  1  4  6  1  4 10  3  3 10  6  7  8  4  2  7  8  3  8  1 10 10  1  2  5
 [257]  3  4  3  8  4  7  2  8  1  3  1  4  1  2  9  2  2  6  5  1  8  8  5  8  7  7  4  9  2  2  3  1 10  5  7  3  9 10  8  9  2  5  6  8  6  5  4  2  4  1  8  5  4  6  2  1  1  2  8 10  2 10  1  1
 [321]  5  1  6  4 10 10  6  7  1  9  9  5  3  8  1  7  1  6  4  3 10  1  6  9  6  4  5  8  6  3  9  8  6  2  5  6  1  9  4  1  7  9  7  6  7  7  6  4  8  2  5  8  6  6  3  3  2  8  4 10  2  5 10  7
 [385]  3  2  4  3  8  9  6  5  8  5 10  4  5  2  1  4  5  8  3  7  9 10  3  8  3  8  7  7  1  7  4  1  1  3  9  2  8  8  7 10  6  9 10  9  6  5  1  5  2 10  9  7  8  3  1  7  4  5  9  7  4  9  8  2
 [449]  7  5 10  5 10  7  4  3  9  4  8  3  9  6  5  3  9  2  7  6  9  9  5  2 10  2  4  4  1  6 10  3  7  7  2  2  6  3  1 10  4  1  3  8  5  6  4  3 10 10  8 10  3  2  6  2  1  4 10  8  7  5  3  5
 [513]  7  7  9  1  1  9  7 10  5  4  6  2  1  8  8  4 10  2  3  4  3  9 10  2  4  5  1  8  3  6  9  7  9  1  2  5  2  7  6  9  3  5 10  2  2  8  9  6  1  2 10  2 10  6  9  5  6  6  4  9  3  1 10  3
 [577]  7  8  6  1  9  9 10  4  3  9  9  7  8  7  3  7 10  3  4  7  2  1  4  6  1 10  8  3  1  7  1  3  2  5 10  1  5  1  9 10  2  3 10 10  7  2  9  5  9  2  5  3  6  5 10  6  4  3  9  7  6 10  6  8
 [641]  1 10  8  6  7  9  8  1  9  5  2  3  2  9  1  8 10  3 10  9  4  2  5  2  4  5  7  8  4  3  2  5  9  1  7  7  6  1  8 10  3  7 10 10  2  1 10  8  6  3  1  4  4  6  9  3  2 10  1  8 10  3  5  8
 [705]  4  1  3  6  5 10 10  7  6  4 10  8  7  3  2  8  9  1 10  2 10  4  8  2  4  9  2  9  4  1  1  2  2  4  8 10  4  8  1  7  2  7  4  8  2  5  4  7  4  8  9  6  9  4  1  4  3  1  5  2  6  3  9  7
 [769]  9  4  4  7  3  3  1  2 10  3  2  6  2  6  2  6  7  8  3  7  5  6  2  3  6  9  3  8  4  1  8  8 10  8  4  5 10  6  6  5  3  3  3  8  5  9 10  7  3  4 10  6  8  5  2  9  9  2  4  5  5 10  4  7
 [833]  2  5  5  3  1  9  3  5  3  8  1  6  5  1  5  4  3  7  4  6 10  5  9  1 10  9  8  9 10  1  2  9  3  6  1  5  9  6  2  4  6  7  8  7  6  3 10  4  7  1  7  1  1  8  5  7  6  3  3  8  8  4  6  2
 [897]  6  9  4 10 10  8  5  9  2  9  7 10  9  4  6  1  2  2  2  7 10  9  6  8  1  5  1  7  7  8  4  5  2  9  2  7  2  9  2 10 10  4  8  5  8  3  1  4  8  1  8 10  1  3  3  1  2  6  3  1  3  4  7  4
 [961]  8  9  7  7  6  5  1  2 10  7  8  9  6  8  7  8  5  8  8  6  4 10  5  9  7  5  5  8  9  1  1  5  6  5  7  7 10  5  5  9  8  4  7  4  3  3  3  2  7  6  8  2  4  7  6  5  8  6  5  4  9  6  4  4
[1025]  6  9  6  6  1  5  1 10  7 10  5  9  7  3  1  7  1  4  5  4  3  5
> printh(a7$cv.groups)
=== a7$cv.groups
   [1]  9  9  3  4  6  8  6  7  5 10  8  8  2  1  3  9  5  9  2  2  6  7  9  4  4  3  5  5  6  8  6  5  6  7  9  6  7  7  6  1  9 10  6  6  7  7  5  8  4  2  5  3  9  2  3  2  5  4  9  7  1  5  5  3
  [65]  6  1  5  7  8  5  6  1  9 10  7  2  4  3 10  1  3  1  2  1  4  1  6  4 10  6  5  5  1  6 10  8  5  1  2  4  2  2  8  4  8  7  7  6  6  6  1  9  8  8  9  9  2 10  7  4  1 10  9 10  9  4  3  1
 [129]  1  9 10  2  2  3 10  7  9  2  5  9  5  6  9 10  8  3  3  5  2  6 10  7  8  9  3  6  3  2  8  2  6  8 10  3  8  5  3  2  4  1 10  6  7  5  3  4  2  2  1  6  5 10  3 10  9  5  9  7  3  5 10 10
 [193]  9  8  4  1  4  2 10  7  5  4  7  2 10  9 10  9  3  4  8  7  3 10  1  4  8  3  4  7 10  9  7  1  4  5  4  7  1  3  8  6  1  4  6  1  4 10  3  3 10  6  7  8  4  2  7  8  3  8  1 10 10  1  2  5
 [257]  3  4  3  8  4  7  2  8  1  3  1  4  1  2  9  2  2  6  5  1  8  8  5  8  7  7  4  9  2  2  3  1 10  5  7  3  9 10  8  9  2  5  6  8  6  5  4  2  4  1  8  5  4  6  2  1  1  2  8 10  2 10  1  1
 [321]  5  1  6  4 10 10  6  7  1  9  9  5  3  8  1  7  1  6  4  3 10  1  6  9  6  4  5  8  6  3  9  8  6  2  5  6  1  9  4  1  7  9  7  6  7  7  6  4  8  2  5  8  6  6  3  3  2  8  4 10  2  5 10  7
 [385]  3  2  4  3  8  9  6  5  8  5 10  4  5  2  1  4  5  8  3  7  9 10  3  8  3  8  7  7  1  7  4  1  1  3  9  2  8  8  7 10  6  9 10  9  6  5  1  5  2 10  9  7  8  3  1  7  4  5  9  7  4  9  8  2
 [449]  7  5 10  5 10  7  4  3  9  4  8  3  9  6  5  3  9  2  7  6  9  9  5  2 10  2  4  4  1  6 10  3  7  7  2  2  6  3  1 10  4  1  3  8  5  6  4  3 10 10  8 10  3  2  6  2  1  4 10  8  7  5  3  5
 [513]  7  7  9  1  1  9  7 10  5  4  6  2  1  8  8  4 10  2  3  4  3  9 10  2  4  5  1  8  3  6  9  7  9  1  2  5  2  7  6  9  3  5 10  2  2  8  9  6  1  2 10  2 10  6  9  5  6  6  4  9  3  1 10  3
 [577]  7  8  6  1  9  9 10  4  3  9  9  7  8  7  3  7 10  3  4  7  2  1  4  6  1 10  8  3  1  7  1  3  2  5 10  1  5  1  9 10  2  3 10 10  7  2  9  5  9  2  5  3  6  5 10  6  4  3  9  7  6 10  6  8
 [641]  1 10  8  6  7  9  8  1  9  5  2  3  2  9  1  8 10  3 10  9  4  2  5  2  4  5  7  8  4  3  2  5  9  1  7  7  6  1  8 10  3  7 10 10  2  1 10  8  6  3  1  4  4  6  9  3  2 10  1  8 10  3  5  8
 [705]  4  1  3  6  5 10 10  7  6  4 10  8  7  3  2  8  9  1 10  2 10  4  8  2  4  9  2  9  4  1  1  2  2  4  8 10  4  8  1  7  2  7  4  8  2  5  4  7  4  8  9  6  9  4  1  4  3  1  5  2  6  3  9  7
 [769]  9  4  4  7  3  3  1  2 10  3  2  6  2  6  2  6  7  8  3  7  5  6  2  3  6  9  3  8  4  1  8  8 10  8  4  5 10  6  6  5  3  3  3  8  5  9 10  7  3  4 10  6  8  5  2  9  9  2  4  5  5 10  4  7
 [833]  2  5  5  3  1  9  3  5  3  8  1  6  5  1  5  4  3  7  4  6 10  5  9  1 10  9  8  9 10  1  2  9  3  6  1  5  9  6  2  4  6  7  8  7  6  3 10  4  7  1  7  1  1  8  5  7  6  3  3  8  8  4  6  2
 [897]  6  9  4 10 10  8  5  9  2  9  7 10  9  4  6  1  2  2  2  7 10  9  6  8  1  5  1  7  7  8  4  5  2  9  2  7  2  9  2 10 10  4  8  5  8  3  1  4  8  1  8 10  1  3  3  1  2  6  3  1  3  4  7  4
 [961]  8  9  7  7  6  5  1  2 10  7  8  9  6  8  7  8  5  8  8  6  4 10  5  9  7  5  5  8  9  1  1  5  6  5  7  7 10  5  5  9  8  4  7  4  3  3  3  2  7  6  8  2  4  7  6  5  8  6  5  4  9  6  4  4
[1025]  6  9  6  6  1  5  1 10  7 10  5  9  7  3  1  7  1  4  5  4  3  5
> printh(a7$cv.list.)
=== a7$cv.list.NULL
> printh(a7)
=== a7
Earth selected 9 of 17 terms, and 5 of 5 predictors 
Importance: age, parch, survived, sibsp, sexmale
Number of terms at each degree of interaction: 1 4 4

Earth
          GCV      RSS        GRSq        RSq     CV-RSq
1st 0.1478715 148.5253 0.253819943 0.28210854 0.26663908
2nd 0.1869804 187.8072 0.003405389 0.04118751 0.01469927
3rd 0.1895587 190.3968 0.241872961 0.27061448 0.24518338
All 0.5244105 526.7293 0.175229617 0.20649767 0.17550725

GLM (family binomial, link logit)
    null.deviance   df  deviance   df iters converged
1st      1223.308 1045  894.8141 1037     5         1
2nd      1175.305 1045 1126.9441 1037     5         1
3rd      1448.213 1045 1118.9411 1037     5         1
> printh(summary(a7))
=== summary(a7)
Call: earth(formula=pclass~., data=etitanic, glm=list(family="binomial"), 
      trace=0.5, keepxy=TRUE, nfold=10, degree=2)

GLM coefficients
                                1st         2nd         3rd
(Intercept)             -2.66307135 -1.93136147  1.37992944
survived                 2.84788552  1.06418271 -2.84378575
sexmale                  1.42483431  0.96598862 -1.45239590
h(sibsp-1)              -0.52879762 -0.64928949  0.79974678
h(2-parch)               1.25518755  0.06534587 -1.29855706
survived * sexmale      -1.25498201 -1.95099222  2.28554497
survived * h(16-age)    -0.17824991  0.09390085  0.02011681
h(55-age) * h(2-parch)  -0.04946408  0.00043737  0.04146455
h(1-sibsp) * h(1-parch) -1.02162885 -0.21902436  1.12490799

Earth selected 9 of 17 terms, and 5 of 5 predictors 
Importance: age, parch, survived, sibsp, sexmale
Number of terms at each degree of interaction: 1 4 4

Earth
          GCV      RSS        GRSq        RSq     CV-RSq
1st 0.1478715 148.5253 0.253819943 0.28210854 0.26663908
2nd 0.1869804 187.8072 0.003405389 0.04118751 0.01469927
3rd 0.1895587 190.3968 0.241872961 0.27061448 0.24518338
All 0.5244105 526.7293 0.175229617 0.20649767 0.17550725

GLM (family binomial, link logit)
    null.deviance   df  deviance   df iters converged
1st      1223.308 1045  894.8141 1037     5         1
2nd      1175.305 1045 1126.9441 1037     5         1
3rd      1448.213 1045 1118.9411 1037     5         1

Cross validation: nterms 10.00 sd 1.25  nvars 5.00 sd 0.00

         CV-RSq         sd  MeanDev         sd     CalibInt         sd CalibSlope        sd       AUC         sd    MaxErr         sd
1st  0.26663909 0.09391989 0.885844 0.10866914 -0.036531748 0.20509947  0.9731181 0.2427761 0.8261347 0.05225729 0.9672056 0.01776306
2nd  0.01469927 0.03315714 1.108196 0.03624298 -0.366966250 0.30939280  0.6679992 0.3054087 0.5844027 0.04655134 0.9278989 0.03591290
3rd  0.24518338 0.06819219 1.112533 0.09931092  0.002921066 0.09693898  0.9431313 0.2335650 0.7913946 0.04170909 0.9715114 0.75433525
mean 0.17550724 0.04994987 1.035524 0.06176683 -0.133525644 0.11353116  0.8614162 0.1685641 0.7339773 0.03081695 0.9715114 0.01288484
> # expect a note: plotmo cannot use factors as axes for degree2 plots...
> plotmo(a7, ycolumn=1)

 grid:    survived    sex age sibsp parch
                 0 female  28     0     0

Note: plotmo cannot use factors as axes for degree2 plots,
      so skipping degree2 plots for: sex
> printh(a7$cv.list[[3]])
=== a7$cv.list[[3]]
Earth selected 9 of 17 terms, and 5 of 5 predictors 
Importance: age, parch, survived, sibsp, sexmale
Number of terms at each degree of interaction: 1 4 4

Earth
          GCV      RSS         GRSq        RSq
1st 0.1489463 133.9725  0.247648064 0.27932246
2nd 0.1883745 169.4370 -0.003241032 0.03899591
3rd 0.1918142 172.5309  0.233055498 0.26534424
All 0.5291350 475.9404  0.167819965 0.20285516

GLM (family binomial, link logit)
    null.deviance  df  deviance  df iters converged
1st      1099.538 940  807.5224 932     5         1
2nd      1057.765 940 1016.9375 932     5         1
3rd      1302.886 940 1013.5486 932     5         1
> printh(summary(a7$cv.list[[3]]))
=== summary(a7$cv.list[[3]])
Call: NULL

GLM coefficients
                                1st         2nd         3rd
(Intercept)             -2.76023896 -1.99708144  1.46636235
survived                 2.97504472  1.01390809 -2.84271641
sexmale                  1.55864597  0.85957508 -1.41517463
h(sibsp-1)              -0.47837855 -0.61330847  0.73656707
h(2-parch)               1.21899307  0.12118104 -1.31887120
survived * sexmale      -1.41870694 -1.74919645  2.21709893
survived * h(16-age)    -0.17382029  0.09840167  0.01452203
h(55-age) * h(2-parch)  -0.04947608  0.00140304  0.04042543
h(1-sibsp) * h(1-parch) -0.96928544 -0.22362177  1.09874097

Earth selected 9 of 17 terms, and 5 of 5 predictors 
Importance: age, parch, survived, sibsp, sexmale
Number of terms at each degree of interaction: 1 4 4

Earth
          GCV      RSS         GRSq        RSq
1st 0.1489463 133.9725  0.247648064 0.27932246
2nd 0.1883745 169.4370 -0.003241032 0.03899591
3rd 0.1918142 172.5309  0.233055498 0.26534424
All 0.5291350 475.9404  0.167819965 0.20285516

GLM (family binomial, link logit)
    null.deviance  df  deviance  df iters converged
1st      1099.538 940  807.5224 932     5         1
2nd      1057.765 940 1016.9375 932     5         1
3rd      1302.886 940 1013.5486 932     5         1
> 
> cat("a7.wp: as above but with wp parameter\n\n")
a7.wp: as above but with wp parameter

> set.seed(3)
> a7.wp <- earth(pclass ~ ., data=etitanic, degree=2, glm=list(family="binomial"), trace=0.5, nfold=10, wp=c(1,3,1))
CV fold  1: CV-RSq 0.126  Per response CV-RSq 0.357  -0.023 0.341  
                          ntrain-nz 255 234 450 ntest-nz  29  27  51 
CV fold  2: CV-RSq 0.112  Per response CV-RSq 0.261  0.027  0.220  
                          ntrain-nz 255 235 451 ntest-nz  29  26  50 
CV fold  3: CV-RSq 0.157  Per response CV-RSq 0.273  0.083  0.262  
                          ntrain-nz 255 235 451 ntest-nz  29  26  50 
CV fold  4: CV-RSq 0.123  Per response CV-RSq 0.165  0.042  0.324  
                          ntrain-nz 255 235 451 ntest-nz  29  26  50 
CV fold  5: CV-RSq 0.156  Per response CV-RSq 0.279  0.064  0.310  
                          ntrain-nz 256 235 451 ntest-nz  28  26  50 
CV fold  6: CV-RSq 0.127  Per response CV-RSq 0.335  0.032  0.203  
                          ntrain-nz 256 235 451 ntest-nz  28  26  50 
CV fold  7: CV-RSq 0.050  Per response CV-RSq 0.074  0.025  0.103  
                          ntrain-nz 256 235 451 ntest-nz  28  26  50 
CV fold  8: CV-RSq 0.113  Per response CV-RSq 0.368  -0.007 0.221  
                          ntrain-nz 256 235 451 ntest-nz  28  26  50 
CV fold  9: CV-RSq 0.039  Per response CV-RSq 0.188  -0.048 0.148  
                          ntrain-nz 256 235 451 ntest-nz  28  26  50 
CV fold 10: CV-RSq 0.162  Per response CV-RSq 0.312  0.087  0.235  
                          ntrain-nz 256 235 451 ntest-nz  28  26  50 
CV all:     CV-RSq 0.117  Per response CV-RSq 0.261  0.028  0.237  
                          ntrain-nz 284 261 501 

> printh(a7.wp)
=== a7.wp
Earth selected 13 of 17 terms, and 5 of 5 predictors 
Importance: age, parch, survived, sexmale, sibsp
Number of terms at each degree of interaction: 1 7 5

Earth
          GCV      RSS        GRSq        RSq     CV-RSq
1st 0.1454622 143.2684 0.265977541 0.30751742 0.26118317
2nd 0.1871535 184.3310 0.002482618 0.05893423 0.02825619
3rd 0.1897382 186.8767 0.241154734 0.28409939 0.23672000
All 0.5379966 529.8830 0.113151717 0.16334033 0.11653435

GLM (family binomial, link logit)
    null.deviance   df deviance   df iters converged
1st      1223.308 1045  870.926 1033     6         1
2nd      1175.305 1045 1103.590 1033     5         1
3rd      1448.213 1045 1093.043 1033     6         1
> printh(summary(a7.wp))
=== summary(a7.wp)
Call: earth(formula=pclass~., data=etitanic, wp=c(1, 3, 1), 
      glm=list(family="binomial"), trace=0.5, nfold=10, 
      degree=2)

GLM coefficients
                                1st         2nd         3rd
(Intercept)             -2.88261609 -1.04543555  0.76912966
survived                 2.76507839  0.95059887 -2.69365940
sexmale                  1.25546493  0.89450305 -1.31875702
h(29-age)                0.02573375 -0.09247487  0.05504313
h(age-44)                0.24264654 -0.12559795 -0.31867587
h(sibsp-1)              -0.50794654 -0.50206910  0.70257703
h(parch-2)              -1.14883026 -0.78597865  1.61708244
h(2-parch)               1.00030096 -0.39669086 -0.45419173
survived * sexmale      -1.10736361 -1.89829166  2.16014037
survived * h(16-age)    -0.20783234  0.21294388 -0.04191587
h(age-47) * h(2-parch)  -0.13139791  0.07410657  0.16341866
h(47-age) * h(2-parch)  -0.05203967  0.01399799  0.02435849
h(1-sibsp) * h(1-parch) -0.95406280 -0.21910647  1.03423515

Earth selected 13 of 17 terms, and 5 of 5 predictors 
Importance: age, parch, survived, sexmale, sibsp
Number of terms at each degree of interaction: 1 7 5

Earth
          GCV      RSS        GRSq        RSq     CV-RSq
1st 0.1454622 143.2684 0.265977541 0.30751742 0.26118317
2nd 0.1871535 184.3310 0.002482618 0.05893423 0.02825619
3rd 0.1897382 186.8767 0.241154734 0.28409939 0.23672000
All 0.5379966 529.8830 0.113151717 0.16334033 0.11653435

GLM (family binomial, link logit)
    null.deviance   df deviance   df iters converged
1st      1223.308 1045  870.926 1033     6         1
2nd      1175.305 1045 1103.590 1033     5         1
3rd      1448.213 1045 1093.043 1033     6         1

Cross validation: nterms 10.10 sd 1.37  nvars 4.90 sd 0.32

         CV-RSq         sd  MeanDev         sd    CalibInt        sd CalibSlope        sd       AUC         sd     MaxErr         sd
1st  0.26118317 0.09356186 0.905585 0.10647201 -0.06899679 0.2272956  0.9375576 0.2330996 0.8179842 0.05159675  0.9914852 0.58077564
2nd  0.02825619 0.04439182 1.096298 0.05202598 -0.26429236 0.4491525  0.7687062 0.4530650 0.6212309 0.07148317  0.9449113 0.03553011
3rd  0.23672000 0.07600801 1.116781 0.10267433  0.01532528 0.1216739  0.9336915 0.2552512 0.7871410 0.04553753 -0.9751335 0.87254164
mean 0.11653435 0.04212394 1.062252 0.04929428 -0.16930972 0.2806729  0.8354735 0.2997902 0.6937636 0.04647268  0.9914852 0.01799983
> 
> # poisson models
> 
> counts <- c(18,  17,  15,  20,  10,  20,  25,  13,  12,
+             18+2,17+2,15+2,20+2,10+2,20+2,25+2,13+2,12+2,
+             18+3,17+3,15+3,20+3,10+3,20+3,25+3,13+3,12+3,
+             18+4,17+4,15+4,20+4,10+4,20+4,25+4,13+4,12+4)
> counts2 <- c(181,171,151,201,101,201,251,131,121,
+              189,179,159,209,109,209,259,139,121,
+              185,175,155,205,105,205,255,135,125,
+              183,173,153,203,103,203,253,133,123)
> outcome <- gl(3,1,4*9)
> treatment <- gl(3,4*3)
> d.AD <- data.frame(treatment, outcome, counts, counts2)
> 
> # one response poisson model
> cat("a8p: one response poisson model\n\n")
a8p: one response poisson model

> a8p <- earth(counts ~ outcome + treatment, glm=list(family=poisson()), trace=0.5, pmethod="none", nfold=3)
CV fold  1: CV-RSq 0.506  ntrain-nz 24 ntest-nz 12 
CV fold  2: CV-RSq 0.574  ntrain-nz 24 ntest-nz 12 
CV fold  3: CV-RSq 0.547  ntrain-nz 24 ntest-nz 12 
CV all:     CV-RSq 0.543  ntrain-nz 36 

> printh(a8p)
=== a8p
Earth selected 5 of 5 terms, and 4 of 4 predictors 
Importance: outcome2, outcome3, treatment3, treatment2
Number of terms at each degree of interaction: 1 4 (additive model)
Earth GCV 17.16461    RSS 347.5833    GRSq 0.2538186    RSq 0.5559459    CV-RSq 0.5425704

GLM null.deviance 41.6537 (35 dof)   deviance 18.97441 (31 dof)   iters 4
> printh(summary(a8p))
=== summary(a8p)
Call: earth(formula=counts~outcome+treatment, glm=list(family=poisson()), 
      trace=0.5, nfold=3, pmethod="none")

GLM coefficients
                counts
(Intercept)  3.0492313
outcome2    -0.4001032
outcome3    -0.2605737
treatment2   0.1102031
treatment3   0.1733820

Earth selected 5 of 5 terms, and 4 of 4 predictors 
Importance: outcome2, outcome3, treatment3, treatment2
Number of terms at each degree of interaction: 1 4 (additive model)
Earth GCV 17.16461    RSS 347.5833    GRSq 0.2538186    RSq 0.5559459    CV-RSq 0.5425704

GLM null.deviance 41.6537 (35 dof)   deviance 18.97441 (31 dof)   iters 4

Cross validation: nterms 5.00 sd 0.00  nvars 4.00 sd 0.00

          CV-RSq         sd   MeanDev         sd  CalibInt        sd CalibSlope        sd       cor         sd   MaxErr       sd
counts 0.5425704 0.03429234 0.6069364 0.09448224 0.1383789 0.4758972  0.9510036 0.1366423 0.7425405 0.04373341 5.625547 5.849157
> # two response poisson model
> cat("a10: two response poisson model\n\n")
a10: two response poisson model

> a10 <- earth(cbind(counts, counts2) ~ outcome + treatment, glm=list(fam="po"), trace=0.5, pmethod="none", nfold=3)
CV fold  1: CV-RSq 0.548  Per response CV-RSq 0.599  0.496  
                          ntrain-nz 24 24 ntest-nz 12 12 
CV fold  2: CV-RSq -1.129 Per response CV-RSq -0.925 -1.333 
                          ntrain-nz 24 24 ntest-nz 12 12 
CV fold  3: CV-RSq 0.387  Per response CV-RSq 0.362  0.413  
                          ntrain-nz 24 24 ntest-nz 12 12 
CV all:     CV-RSq -0.065 Per response CV-RSq 0.012  -0.141 
                          ntrain-nz 36 36 

> printh(a10)
=== a10
Earth selected 4 of 4 terms, and 3 of 4 predictors 
Importance: outcome2, outcome3, treatment2, treatment3-unused
Number of terms at each degree of interaction: 1 3 (additive model)

Earth
               GCV       RSS      GRSq       RSq      CV-RSq
counts    17.59156   410.958 0.2352582 0.4749814  0.01192611
counts2 1461.64328 34145.611 0.3039166 0.5221174 -0.14133055
All     1479.23484 34556.569 0.3031726 0.5216067 -0.06470222

GLM (family poisson, link log)
        null.deviance df  deviance df iters converged
counts        41.6537 35  22.35113 32     4         1
counts2      418.8258 35 204.97309 32     4         1
> printh(summary(a10))
=== summary(a10)
Call: earth(formula=cbind(counts, counts2)~outcome+treatment, 
      glm=list(fam="po"), trace=0.5, nfold=3, pmethod="none")

GLM coefficients
                 counts    counts2
(Intercept)  3.13967527  5.3622792
outcome2    -0.40010316 -0.4422645
outcome3    -0.26057375 -0.2900158
treatment2   0.01975915  0.0179835

Earth selected 4 of 4 terms, and 3 of 4 predictors 
Importance: outcome2, outcome3, treatment2, treatment3-unused
Number of terms at each degree of interaction: 1 3 (additive model)

Earth
               GCV       RSS      GRSq       RSq      CV-RSq
counts    17.59156   410.958 0.2352582 0.4749814  0.01192611
counts2 1461.64328 34145.611 0.3039166 0.5221174 -0.14133055
All     1479.23484 34556.569 0.3031726 0.5216067 -0.06470222

GLM (family poisson, link log)
        null.deviance df  deviance df iters converged
counts        41.6537 35  22.35113 32     4         1
counts2      418.8258 35 204.97309 32     4         1

Cross validation: nterms 5.00 sd 0.00  nvars 4.00 sd 0.00

             CV-RSq        sd   MeanDev        sd  CalibInt       sd CalibSlope        sd       cor        sd     MaxErr       sd
counts   0.01192611 0.8203755 0.9011027 0.1269893 0.8518902 1.599211  0.7113432 0.5215928 0.5585294 0.2861361   6.609942  7.01380
counts2 -0.14133055 1.0326875 9.6527867 1.9456886 1.1479040 2.649913  0.7787410 0.5080124 0.5806144 0.1866414 -68.872387 73.40375
mean    -0.06470222 0.9252687 5.2769447 1.0360944 0.9998971 2.117370  0.7450421 0.5131495 0.5695719 0.2362784 -68.872387 73.40375
> # two response binomial model (not yet supported)
> cat("Expect an error here ")
Expect an error here > z <- try(earth(cbind(counts, counts2) ~ outcome + treatment, glm=list(fam="bi"), trace=0.5, pmethod="none", nfold=3))
Error : earth does not (yet) support cross validation of paired binomial responses
> if (class(z) != "try-error")
+     stop("test failed")
> 
> # plot.earth.models with cross validated models
> set.seed(1)
> a <- earth(survived ~ ., data=etitanic, nfold=3, keepxy=TRUE)
> plot.earth.models(a$cv.list, main="cross validated models")
> 
> if(!interactive()) {
+     dev.off()         # finish postscript plot
+     q(runLast=FALSE)  # needed else R prints the time on exit (R2.5 and higher) which messes up the diffs
+ }
