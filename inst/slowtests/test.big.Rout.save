> # test.big: test earth with a biggish model
> 
> library(earth)
Loading required package: plotmo
Loading required package: plotrix
Loading required package: TeachingDemos
> if(!interactive())
+     postscript(paper="letter")
> options(warn=2) # treat warnings as errors
> options(digits = 3)
> printf <- function(format, ...) cat(sprintf(format, ...)) # like c printf
> start.time <- proc.time()
> set.seed(2015)
> 
> N <- 12000 # big enough to cross ten-thousand-cases barrier in plotres and plotmo
> 
> # N <- 2e6 # x matrix 1.5 GB, bx will be much bigger
> #
> # N <- 3e6 # x matrix 2.24 GB, peak memory 15 GB
> #
> # N <- 6e6 # x matrix 4.5GB,
> #          # rterm.exe peak memory under Win7 is 31 GB
> #          # (but with 32GB total memory on the machine, so maybe hitting that limit)
> #
> # N <- 1e7 # Out of memory (could not allocate 15 GB)
> 
> ran <- function() runif(N, min=-1, max=1)
> 
> x <- cbind(
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(),
+     ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran(), ran())
> 
> colnames(x) <- c(
+     "x01", "x02", "x03", "x04", "x05", "x06", "x07", "x08", "x09", "x10",
+     "x11", "x12", "x13", "x14", "x15", "x16", "x17", "x18", "x19", "x20",
+     "x21", "x22", "x23", "x24", "x25", "x26", "x27", "x28", "x29", "x30",
+     "x31", "x32", "x33", "x34", "x35", "x36", "x37", "x38", "x39", "x40",
+     "x41", "x42", "x43", "x44", "x45", "x46", "x47", "x48", "x49", "x50",
+     "x51", "x52", "x53", "x54", "x55", "x56", "x57", "x58", "x59", "x60",
+     "x61", "x62", "x63", "x64", "x65", "x66", "x67", "x68", "x69", "x70",
+     "x71", "x72", "x73", "x74", "x75", "x76", "x77", "x78", "x79", "x80",
+     "x81", "x82", "x83", "x84", "x85", "x86", "x87", "x88", "x89", "x90",
+     "x91", "x92", "x93", "x94", "x95", "x96", "x97", "x98", "x99", "x100")
> 
> func1 <- function(x)
+ {
+      sin(6 * x[,1]) + x[,2] + 4 * x[,3]^2
+ }
> y <- func1(x)
> degree <- 1
> trace <- 4
> cat("test 1: nrow(x)", nrow(x), "ncol(x)", ncol(x), "degree", degree, "trace", trace, "\n")
test 1: nrow(x) 12000 ncol(x) 100 degree 1 trace 4 
> 
> a1 <- earth(x, y, degree=degree, trace=trace)
Call: earth(x=x, y=y, trace=trace, degree=degree)

x[12000,100]:
         x01    x02     x03    x04    x05     x06    x07     x08    x09 ...
1     -0.878  0.223  0.0166  0.540  0.969  0.1755 -0.644  0.6905  0.281 ...
2      0.678  0.155 -0.7243 -0.644  0.497 -0.8698 -0.874  0.0221 -0.250 ...
3     -0.403  0.681  0.3617  0.227 -0.428 -0.3517  0.708  0.2177  0.730 ...
...   -0.937  0.496 -0.6514  0.120  0.329 -0.3010 -0.859 -0.6295 -0.242 ...
12000 -0.670 -0.680  0.7078 -0.878 -0.472  0.0286  0.630  0.7453 -0.362 ...

y[12000,1]:
          y
1     1.074
2     1.453
3     0.541
...   2.807
12000 2.093

Forward pass:    minspan 9    endspan 13    x is 12000 by 100 (9.16 MB)

         GRSq    RSq     DeltaRSq Pred     PredName         Cut  Terms   ParentTerm
1      0.0000 0.0000                    (Intercept)
2      0.5859 0.5861       0.5861    3          x03   -0.021746  2   3   
4      0.7310 0.7314       0.1453    2          x02      0.9909  4   5   
6      0.7893 0.7897      0.05829    1          x01    -0.38744  6   7   
8      0.8930 0.8932       0.1035    1          x01      0.2722  8       
10     0.9115 0.9117      0.01846    3          x03     0.58979  9       
12     0.9313 0.9316      0.01986    3          x03    -0.53382  10      
14     0.9487 0.9489      0.01731    1          x01    -0.13397  11      
16     0.9711 0.9712      0.02236    1          x01     0.74543  12      
18     0.9729 0.9730     0.001817    3          x03     0.30619  13      
20     0.9732 0.9733    0.0003123    3          x03     0.81261  14      reject term

RSq changed by less than 0.001 at 19 terms, 13 terms used (DeltaRSq 0.00031)
After forward pass GRSq 0.973 RSq 0.973
Forward pass complete: 19 terms, 13 terms used

Subset size        GRSq     RSq  DeltaGRSq nPreds  Terms (col nbr in bx)
          1      0.0000  0.0000     0.0000      0  1
          2      0.1245  0.1248     0.1245      1  1 3
          3      0.5978  0.5980     0.4733      1  1 3 10
          4      0.7424  0.7426     0.1446      2  1 3 5 10
          5      0.7899  0.7902     0.0476      3  1 3 5 8 10
          6      0.8281  0.8284     0.0382      3  1 3 5 8 10 11
          7      0.9199  0.9201     0.0918      3  1 3 5 7 8 10 11
          8      0.9450  0.9451     0.0251      3  1 3 5 7 8 9 10 11
          9      0.9665  0.9666     0.0215      3  1 3 5 7 8 9 10 11 12
         10      0.9690  0.9691     0.0025      3  1 3 5 6 7 8 9 10 11 12
         11      0.9711  0.9712     0.0022      3  1 2 3 5 6 7 8 9 10 11 12
chosen   12      0.9729  0.9730     0.0018      3  1 2 3 5 6 7 8 9 10 11 12 13
         13      0.9729  0.9730    -0.0000      3  1 2 3 4 5 6 7 8 9 10 11 12 13

Prune method "backward" penalty 2 nprune 13: selected 12 of 13 terms, and 3 of 100 predictors
After backward pass GRSq 0.973 RSq 0.973 
> 
> cat("print(summary(a1)):\n")
print(summary(a1)):
> print(summary(a1))
Call: earth(x=x, y=y, trace=trace, degree=degree)

                   coefficients
(Intercept)              -1.743
h(-0.387437-x01)          2.852
h(x01- -0.387437)        -1.396
h(x01- -0.133967)         6.672
h(x01-0.272197)         -10.424
h(x01-0.745427)           7.889
h(0.990904-x02)          -0.999
h(x03- -0.53382)          4.129
h(-0.0217463-x03)         6.253
h(x03- -0.0217463)       -2.706
h(x03-0.306195)           1.955
h(x03-0.589794)           2.961

Selected 12 of 13 terms, and 3 of 100 predictors 
Termination condition: RSq changed by less than 0.001 at 13 terms
Importance: x03, x02, x01, x04-unused, x05-unused, x06-unused, x07-unused, ...
Number of terms at each degree of interaction: 1 11 (additive model)
GCV 0.0619    RSS 740    GRSq 0.973    RSq 0.973
> 
> cat("print(a1):\n")
print(a1):
> print(a1)
Selected 12 of 13 terms, and 3 of 100 predictors 
Termination condition: RSq changed by less than 0.001 at 13 terms
Importance: x03, x02, x01, x04-unused, x05-unused, x06-unused, x07-unused, ...
Number of terms at each degree of interaction: 1 11 (additive model)
GCV 0.0619    RSS 740    GRSq 0.973    RSq 0.973
> 
> cat("plot(a1):\n")
plot(a1):
> plot(a1)
> 
> cat("plotmo(a1):\n")
plotmo(a1):
> plotmo(a1)
 grid:    x01      x02    x03      x04     x05     x06    x07    x08     x09
      -0.0176 -0.00151 0.0157 -0.00876 0.00135 0.00113 0.0073 0.0208 -0.0224
    x10     x11       x12     x13      x14       x15     x16      x17    x18
 0.0154 0.00272 -0.000211 0.00344 -0.00544 -8.58e-05 0.00858 -0.00388 0.0094
     x19     x20    x21      x22    x23      x24      x25     x26     x27
 0.00126 -0.0031 0.0108 -0.00429 0.0117 -0.00545 -0.00674 0.00263 -0.0159
      x28      x29     x30    x31     x32     x33     x34     x35     x36
 -0.00155 -0.00107 -0.0115 0.0133 0.00735 -0.0026 0.00504 0.00965 0.00294
      x37     x38      x39    x40     x41     x42    x43    x44    x45     x46
 -0.00342 0.00449 -0.00203 0.0205 -0.0037 -0.0111 0.0033 0.0148 0.0104 -0.0061
       x47      x48    x49       x50     x51     x52       x53      x54
 -5.08e-05 -0.00606 0.0111 -0.000364 -0.0172 0.00663 -0.000877 -0.00858
      x55     x56     x57      x58    x59      x60    x61      x62      x63
 -0.00219 0.00634 -0.0152 -0.00162 0.0065 -0.00763 0.0039 -0.00134 -0.00981
     x64     x65      x66       x67    x68      x69    x70      x71    x72
 -0.0124 0.00189 -0.00563 -1.06e-05 0.0143 0.000658 0.0106 0.000291 0.0196
     x73     x74     x75      x76      x77     x78     x79     x80     x81
 -0.0036 0.00904 0.00797 -0.00707 -0.00538 0.00533 -0.0166 0.00214 0.00674
      x82      x83     x84      x85      x86     x87     x88     x89     x90
 -0.00881 -0.00498 0.00163 0.000258 -0.00367 0.00434 0.00165 -0.0219 0.00142
     x91     x92    x93       x94     x95       x96     x97     x98      x99
 0.00365 0.00104 0.0193 -0.000123 0.00223 -0.000211 -0.0041 -0.0101 -0.00754
     x100
 -0.00315
> 
> func2 <- function(x)
+ {
+      x[,1] + x[,2] + x[,3] * x[,4]
+ }
> y <- func2(x)
> degree <- 1
> trace <- 4
> cat("test 2: nrow(x)", nrow(x), "ncol(x)", ncol(x), "degree", degree, "trace", trace, "\n")
test 2: nrow(x) 12000 ncol(x) 100 degree 1 trace 4 
> 
> a2 <- earth(x, y, degree=degree, trace=trace)
Call: earth(x=x, y=y, trace=trace, degree=degree)

x[12000,100]:
         x01    x02     x03    x04    x05     x06    x07     x08    x09 ...
1     -0.878  0.223  0.0166  0.540  0.969  0.1755 -0.644  0.6905  0.281 ...
2      0.678  0.155 -0.7243 -0.644  0.497 -0.8698 -0.874  0.0221 -0.250 ...
3     -0.403  0.681  0.3617  0.227 -0.428 -0.3517  0.708  0.2177  0.730 ...
...   -0.937  0.496 -0.6514  0.120  0.329 -0.3010 -0.859 -0.6295 -0.242 ...
12000 -0.670 -0.680  0.7078 -0.878 -0.472  0.0286  0.630  0.7453 -0.362 ...

y[12000,1]:
           y
1     -0.646
2      1.300
3      0.360
...   -0.520
12000 -1.971

Forward pass:    minspan 9    endspan 13    x is 12000 by 100 (9.16 MB)

         GRSq    RSq     DeltaRSq Pred     PredName         Cut  Terms   ParentTerm
1      0.0000 0.0000                    (Intercept)
2      0.4309 0.4313       0.4313    1          x01    -0.36489  2   3   
4      0.8555 0.8557       0.4244    2          x02     0.99734  4   5   
6      0.8557 0.8559    0.0002378    4          x04      0.8412  6   7   reject term

RSq changed by less than 0.001 at 5 terms (DeltaRSq 0.00024)
After forward pass GRSq 0.856 RSq 0.856
Forward pass complete: 5 terms

Subset size        GRSq     RSq  DeltaGRSq nPreds  Terms (col nbr in bx)
          1      0.0000  0.0000     0.0000      0  1
          2      0.4280  0.4282     0.4280      1  1 5
          3      0.8279  0.8280     0.3999      2  1 2 5
chosen    4      0.8555  0.8557     0.0276      2  1 2 3 5
          5      0.8555  0.8557    -0.0000      2  1 2 3 4 5

Prune method "backward" penalty 2 nprune 5: selected 4 of 5 terms, and 2 of 100 predictors
After backward pass GRSq 0.856 RSq 0.856 
> 
> cat("print(summary(a2)):\n")
print(summary(a2)):
> print(summary(a2))
Call: earth(x=x, y=y, trace=trace, degree=degree)

                 coefficients
(Intercept)             0.615
h(-0.36489-x01)        -0.978
h(x01- -0.36489)        1.011
h(0.997335-x02)        -0.991

Selected 4 of 5 terms, and 2 of 100 predictors 
Termination condition: RSq changed by less than 0.001 at 5 terms
Importance: x02, x01, x03-unused, x04-unused, x05-unused, x06-unused, ...
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 0.111    RSS 1326    GRSq 0.856    RSq 0.856
> 
> printf("[total time %.3f]\n", (proc.time() - start.time)[3])
[total time 2.420]
> if(!interactive()) {
+     dev.off()         # finish postscript plot
+     q(runLast=FALSE)  # needed else R prints the time on exit (R2.5 and higher) which messes up the diffs
+ }
