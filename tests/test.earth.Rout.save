

> # test.earth.R
> # The intention here is to check for porting problems by building
> # a model with tracing enabled, and to call each earth routine once.
> # For more comprehensive tests see earth\src\tests.
> # Not tested: mars.to.earth, plot.earth, plot.earth.models, plotmo
> library(earth)
Loading required package: leaps
> options(digits=3)
> data(ozone1)
> a <- earth(O3 ~ ., data = ozone1, degree = 2, trace = 4)
Call: earth(formula=O3~., data=ozone1, trace=4, degree=2)
x is a 330 by 9 matrix: 1=vh, 2=wind, 3=humidity, 4=temp, 5=ibh, 6=dpg, 7=ibt, 8=vis, 9=doy
First few rows of x are
       vh wind humidity temp  ibh dpg ibt vis doy
[1,] 5710    4       28   40 2693 -25  87 250  33
[2,] 5700    3       37   45  590 -24 128 100  34
[3,] 5760    3       51   54 1450  25 139  60  35
[4,] 5720    4       69   35 1568  15 121  60  36
[5,] 5790    6       19   45 2631 -33 123 100  37
[6,] 5790    3       25   55  554 -28 182 250  38
y is a 330 by 1 matrix: 1=O3
First few rows of y are
     O3
[1,]  3
[2,]  5
[3,]  5
[4,]  6
[5,]  4
[6,]  4
Forward pass: minspan 6 endspan 10

         GRSq    RSq     DeltaRSq Pred     PredName         Cut  Terms   ParentTerm
1      0.0000 0.0000                                             1
2      0.6493 0.6599       0.6599    4         temp          58  2   3   
4      0.6908 0.7094      0.04948    5          ibh        1069  4   5   
6      0.7110 0.7368      0.02744    9          doy          89  6   7   
8      0.7300 0.7618        0.025    3     humidity          56  8   9   2   
10     0.7546 0.7904      0.02865    6          dpg          54  10  11  2   
12     0.7597 0.8015       0.0111    8          vis         200  12  13  
14     0.7633 0.8110     0.009428    2         wind           7  14  15  13  
16     0.7637 0.8177     0.006729    6          dpg          44  16  17  5   
18     0.7678 0.8270     0.009305    7          ibt         233  18  19  
20     0.7659 0.8317     0.004672    9          doy         159  20  21  2   

Reached max number of terms 21
After forward pass GRSq 0.7659 RSq 0.8317
Forward pass complete: 21 terms

Subset size        GRSq     RSq  DeltaGRSq nPreds  Terms (col nbr in bx)
          1      0.0000  0.0000     0.0000      0  1
          2      0.6408  0.6462     0.6408      1  1 2
          3      0.6909  0.7002     0.0501      2  1 2 4
          4      0.7018  0.7153     0.0109      3  1 2 9 19
          5      0.7108  0.7281     0.0090      4  1 2 6 9 19
          6      0.7377  0.7573     0.0269      4  1 2 6 7 9 19
          7      0.7566  0.7783     0.0189      5  1 2 6 7 9 11 19
          8      0.7657  0.7900     0.0091      6  1 2 6 7 9 11 13 19
          9      0.7768  0.8031     0.0111      7  1 2 6 7 9 11 13 17 19
         10      0.7851  0.8135     0.0082      7  1 2 6 7 9 10 11 13 17 19
chosen   11      0.7910  0.8216     0.0059      8  1 2 6 7 9 10 11 13 14 17 19
         12      0.7897  0.8234    -0.0013      8  1 2 6 7 9 10 11 13 14 17 19 20
         13      0.7895  0.8261    -0.0002      8  1 2 6 7 9 10 11 13 14 17 19 20 21
         14      0.7872  0.8272    -0.0023      8  1 2 5 6 7 9 10 11 13 14 17 19 20 21
         15      0.7854  0.8286    -0.0018      8  1 2 5 6 7 9 10 11 13 14 16 17 19 20 21
         16      0.7833  0.8298    -0.0021      8  1 2 5 6 7 9 10 11 13 14 15 16 17 19 20 21
         17      0.7804  0.8306    -0.0028      8  1 2 5 6 7 8 9 10 11 13 14 15 16 17 19 20 21
         18      0.7772  0.8310    -0.0032      8  1 2 4 5 6 7 8 9 10 11 13 14 15 16 17 19 20 21
         19      0.7738  0.8314    -0.0034      8  1 2 3 4 5 6 7 8 9 10 11 13 14 15 16 17 19 20 21
         20      0.7700  0.8316    -0.0038      8  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 19 20 21
         21      0.7659  0.8317    -0.0040      8  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21

Prune method "backward" penalty 3 nprune 21: selected 11 of 21 terms, and 8 of 9 predictors
After backward pass GRSq 0.791 RSq 0.8216 
> print(a, digits = 3)
Selected 11 of 21 terms, and 8 of 9 predictors 
Importance: temp, humidity, ibt, doy, dpg, ibh, vis, wind, vh-unused
Number of terms at each degree of interaction: 1 5 5
GCV 13.5    RSS 3768    GRSq 0.791    RSq 0.822
> print(summary(a, digits = 3))
Call: earth(formula=O3~., data=ozone1, trace=4, degree=2)

                            coefficients
(Intercept)                       14.889
h(temp-58)                         0.321
h(233-ibt)                        -0.046
h(200-vis)                         0.022
h(doy-89)                         -0.023
h(89-doy)                         -0.144
h(wind-7) * h(200-vis)            -0.019
h(56-humidity) * h(temp-58)       -0.021
h(temp-58) * h(dpg-54)            -0.019
h(temp-58) * h(54-dpg)             0.004
h(1069-ibh) * h(44-dpg)            0.000

Selected 11 of 21 terms, and 8 of 9 predictors 
Importance: temp, humidity, ibt, doy, dpg, ibh, vis, wind, vh-unused
Number of terms at each degree of interaction: 1 5 5
GCV 13.5    RSS 3768    GRSq 0.791    RSq 0.822
> print(evimp(a, trim=FALSE))
          nsubsets   gcv    rss
temp            10 100.0  100.0
humidity         8  35.6   38.4
ibt              8  35.6   38.4
doy              7  33.6   36.0
dpg              5  25.9   28.0
ibh              4  30.9>  32.3>
vis              4  20.8   22.9
wind             1   8.7    9.9
vh-unused        0   0.0    0.0
> a <- update(a, nprune = 5, trace = 0)
> print(a, digits = 3)
Selected 5 of 21 terms, and 4 of 9 predictors 
Importance: temp, humidity, ibt, ibh-unused, doy, vh-unused, wind-unused, dpg-unused, vis-unused
Number of terms at each degree of interaction: 1 3 1
GCV 18.6    RSS 5741    GRSq 0.711    RSq 0.728
> print(earth:::get.nterms.per.degree(a))

0 1 2 
1 3 1 
> print(earth:::get.nused.preds.per.subset(a$dirs, a$which.terms))
[1] 0 1 1 1 1 1 1 2 2
> print(variable.names(a)[1:3])
[1] "vh"       "wind"     "humidity"
> print(deviance(a))
[1] 5741
> print(earth:::reorder.earth(a))
[1] 1 2 5 3 4
> print(predict(a, c(5710, 4, 28, 40, 2693, -25, 87, 250, 33)))
       O3
[1,] 6.63
> a <- earth(O3 ~ ., data = ozone1, degree = 1, minspan = 1)
> print(a, digits = 6)
Selected 14 of 19 terms, and 8 of 9 predictors 
Importance: temp, ibh, doy, dpg, humidity, vh, vis, wind, ibt-unused
Number of terms at each degree of interaction: 1 13 (additive model)
GCV 14.8126    RSS 4121    GRSq 0.769904    RSq 0.804834
> print(summary(a, digits = 6, style = "pmax"))
Call: earth(formula=O3~., data=ozone1, degree=1, minspan=1)

O3 =
  8.56555
  +   0.0153584 * pmax(0,       vh -     5740) 
  -   0.0135079 * pmax(0,     5740 -       vh) 
  +    0.303387 * pmax(0,        9 -     wind) 
  +     0.24189 * pmax(0, humidity -       39) 
  -    0.227282 * pmax(0, humidity -       54) 
  +    0.378576 * pmax(0,     temp -       58) 
  - 0.000600086 * pmax(0,      ibh -     1023) 
  -  0.00313283 * pmax(0,     1023 -      ibh) 
  -    0.107166 * pmax(0,      dpg -       12) 
  +   0.0456812 * pmax(0,       80 -      vis) 
  +   0.0469864 * pmax(0,      doy -       89) 
  -    0.124658 * pmax(0,       89 -      doy) 
  -   0.0911118 * pmax(0,      doy -      159) 

Selected 14 of 19 terms, and 8 of 9 predictors 
Importance: temp, ibh, doy, dpg, humidity, vh, vis, wind, ibt-unused
Number of terms at each degree of interaction: 1 13 (additive model)
GCV 14.8126    RSS 4121    GRSq 0.769904    RSq 0.804834
> 
