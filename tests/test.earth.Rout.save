

> # test.earth.R
> # The intention here is to check for porting problems by building
> # a model with tracing enabled, and to call each earth routine once.
> # For more comprehensive tests see earth\src\tests.
> # Not tested: mars.to.earth, plot.earth, plot.earth.models, plotmo
> library(earth)
Loading required package: leaps
Loading required package: plotmo
Loading required package: plotrix
> options(digits=3)
> data(trees)
> fit1 <- earth(Volume ~ ., data = trees, degree = 2, trace = 4)
Call: earth(formula=Volume~., data=trees, trace=4, degree=2)
x is a 31 by 2 matrix: 1=Girth, 2=Height
First few rows of x are
     Girth Height
[1,]   8.3     70
[2,]   8.6     65
[3,]   8.8     63
[4,]  10.5     72
[5,]  10.7     81
[6,]  10.8     83
y is a 31 by 1 matrix: 1=Volume
First few rows of y are
     Volume
[1,]   10.3
[2,]   10.3
[3,]   10.2
[4,]   16.4
[5,]   18.8
[6,]   19.7
Forward pass: minspan 4 endspan 8

         GRSq    RSq     DeltaRSq Pred     PredName         Cut  Terms   ParentTerm
1      0.0000 0.0000                                             1
2      0.9443 0.9613       0.9613    1        Girth          14  2   3   
4      0.9456 0.9758       0.0145    2       Height          72  4   5   
6      0.9126 0.9781     0.002297    1        Girth        14.2  6   7   4   
8      0.8118 0.9791    0.0009535    2       Height          74  8   9   reject term

Reached delta RSq threshold (DeltaRSq 0.000953536 < 0.001) at 7 terms
After forward pass GRSq 0.8118 RSq 0.9791
Forward pass complete: 7 terms

Subset size        GRSq     RSq  DeltaGRSq nPreds  Terms (col nbr in bx)
          1      0.0000  0.0000     0.0000      0  1
          2      0.8315  0.8584     0.8315      1  1 2
          3      0.9443  0.9613     0.1128      1  1 2 3
chosen    4      0.9568  0.9757     0.0125      2  1 2 3 4
          5      0.9477  0.9768    -0.0090      2  1 2 3 4 6
          6      0.9336  0.9774    -0.0141      2  1 2 3 4 6 7
          7      0.9126  0.9781    -0.0211      2  1 2 3 4 5 6 7

Prune method "backward" penalty 3 nprune 7: selected 4 of 7 terms, and 2 of 2 predictors
After backward pass GRSq 0.9568 RSq 0.9757 
> print(fit1, digits = 3)
Selected 4 of 7 terms, and 2 of 2 predictors 
Importance: Girth, Height
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 12.1    RSS 197    GRSq 0.957    RSq 0.976
> print(summary(fit1, digits = 3))
Call: earth(formula=Volume~., data=trees, trace=4, degree=2)

             coefficients
(Intercept)        27.246
h(Girth-14)         6.177
h(14-Girth)        -3.266
h(Height-72)        0.491

Selected 4 of 7 terms, and 2 of 2 predictors 
Importance: Girth, Height
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 12.1    RSS 197    GRSq 0.957    RSq 0.976
> print(evimp(fit1, trim=FALSE))
       nsubsets   gcv    rss
Girth         3 100.0  100.0
Height        1  11.4   12.1
> fit2 <- update(fit1, nprune = 3, trace = 0)
> print(fit2, digits = 3)
Selected 3 of 7 terms, and 1 of 2 predictors 
Importance: Girth, Height-unused
Number of terms at each degree of interaction: 1 2 (additive model)
GCV 15.5    RSS 313    GRSq 0.944    RSq 0.961
> print(earth:::get.nterms.per.degree(fit1))

0 1 
1 3 
> print(earth:::get.nused.preds.per.subset(fit1$dirs, fit1$which.terms))
[1] 0 1
> print(variable.names(fit1))
[1] "Girth"  "Height"
> print(deviance(fit1))
[1] 197
> print(earth:::reorder.earth(fit1))
[1] 1 2 3 4
> print(predict(fit1, c(70, 12)))
     Volume
[1,]    373
> fit3 <- earth(Volume ~ ., data = trees, degree = 1, minspan = 1)
> print(fit3, digits = 4)
Selected 4 of 5 terms, and 2 of 2 predictors 
Importance: Girth, Height
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 10.67    RSS 198.2    GRSq 0.9618    RSq 0.9755
> print(summary(fit3, digits = 3, style = "pmax"))
Call: earth(formula=Volume~., data=trees, degree=1, minspan=1)

Volume =
  27.1
  + 6.08 * pmax(0,  Girth -   13.8) 
  - 3.25 * pmax(0,   13.8 -  Girth) 
  +  0.6 * pmax(0, Height -     75) 

Selected 4 of 5 terms, and 2 of 2 predictors 
Importance: Girth, Height
Number of terms at each degree of interaction: 1 3 (additive model)
GCV 10.7    RSS 198    GRSq 0.962    RSq 0.976
> 
