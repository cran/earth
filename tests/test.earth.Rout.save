

> # test.earth.R
> # The intention here is to check for porting problems by building
> # a model with tracing enabled, and to call each earth routine once.
> # For more comprehensive tests see earth\src\tests.
> # Not tested: mars.to.earth, plot.earth, plot.earth.models, plotmo
> library(earth)
Loading required package: leaps
> options(digits=3)
> data(ozone1)
> a <- earth(O3 ~ ., data = ozone1, degree = 2, trace = 4)
Call: earth(formula=O3~., data=ozone1, trace=4, degree=2)
x is a 330 by 9 matrix: 1=vh, 2=wind, 3=humidity, 4=temp, 5=ibh, 6=dpg, 7=ibt, 8=vis, 9=doy
First few rows of x are
       vh wind humidity temp  ibh dpg ibt vis doy
[1,] 5710    4       28   40 2693 -25  87 250  33
[2,] 5700    3       37   45  590 -24 128 100  34
[3,] 5760    3       51   54 1450  25 139  60  35
[4,] 5720    4       69   35 1568  15 121  60  36
[5,] 5790    6       19   45 2631 -33 123 100  37
[6,] 5790    3       25   55  554 -28 182 250  38
y is a 330 by 1 matrix: 1=O3
First few rows of y are
     O3
[1,]  3
[2,]  5
[3,]  5
[4,]  6
[5,]  4
[6,]  4
Approximate memory use after expanding x and y matrices: 0.2 MBytes
Forward pass: minspan 8 endspan 15

         GRSq    RSq     DeltaRSq Pred     PredName         Cut  Terms   ParentTerm
1      0.0000 0.0000                                             1
2      0.6493 0.6599       0.6599    4         temp          58  2   3   
4      0.6903 0.7088      0.04898    5          ibh        1108  4   5   
6      0.7102 0.7361      0.02722    9          doy          92  6   7   
8      0.7295 0.7614      0.02532    3     humidity          55  8   9   2   
10     0.7546 0.7904      0.02906    6          dpg          54  10  11  2   
12     0.7597 0.8015      0.01109    8          vis         200  12  13  
14     0.7632 0.8109     0.009396    2         wind           7  14  15  13  
16     0.7640 0.8179      0.00697    6          dpg          44  16  17  5   
18     0.7685 0.8275     0.009595    7          ibt         234  18  19  
20     0.7662 0.8318     0.004351    9          doy         159  20  21  2   

Reached max number of terms 21
After forward pass GRSq 0.7662 RSq 0.8318
Forward pass complete: 21 terms

Subset size        GRSq     RSq  DeltaGRSq nPreds  Terms (col nbr in bx)
          1      0.0000  0.0000     0.0000      0  1
          2      0.6408  0.6462     0.6408      1  1 2
          3      0.6910  0.7003     0.0502      2  1 2 4
          4      0.7022  0.7156     0.0112      3  1 2 9 19
          5      0.7114  0.7286     0.0092      4  1 2 6 9 19
          6      0.7379  0.7574     0.0265      4  1 2 6 7 9 19
          7      0.7566  0.7783     0.0187      5  1 2 6 7 9 11 19
          8      0.7658  0.7900     0.0091      6  1 2 6 7 9 11 13 19
          9      0.7772  0.8035     0.0115      7  1 2 6 7 9 11 13 17 19
         10      0.7855  0.8138     0.0082      7  1 2 6 7 9 10 11 13 17 19
chosen   11      0.7913  0.8218     0.0059      8  1 2 6 7 9 10 11 13 14 17 19
         12      0.7897  0.8234    -0.0016      8  1 2 6 7 9 10 11 13 14 17 19 20
         13      0.7893  0.8260    -0.0004      8  1 2 6 7 9 10 11 13 14 17 19 20 21
         14      0.7869  0.8269    -0.0024      8  1 2 5 6 7 9 10 11 13 14 17 19 20 21
         15      0.7853  0.8285    -0.0016      8  1 2 5 6 7 9 10 11 13 14 16 17 19 20 21
         16      0.7832  0.8298    -0.0021      8  1 2 5 6 7 9 10 11 13 14 15 16 17 19 20 21
         17      0.7806  0.8307    -0.0025      8  1 2 5 6 7 8 9 10 11 13 14 15 16 17 19 20 21
         18      0.7774  0.8312    -0.0033      8  1 2 4 5 6 7 8 9 10 11 13 14 15 16 17 19 20 21
         19      0.7739  0.8315    -0.0034      8  1 2 3 4 5 6 7 8 9 10 11 13 14 15 16 17 19 20 21
         20      0.7702  0.8318    -0.0037      8  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 19 20 21
         21      0.7662  0.8318    -0.0040      8  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21

Prune method "backward" penalty 3 nprune 21: selected 11 of 21 terms, and 8 of 9 predictors
After backward pass GRSq 0.7913 RSq 0.8218 
> print(a, digits = 3)
Selected 11 of 21 terms, and 8 of 9 predictors 
Importance: temp, humidity, ibt, doy, dpg, ibh, vis, wind, vh-unused
Number of terms at each degree of interaction: 1 5 5
GCV 13.4    RSS 3762    GRSq 0.791    RSq 0.822
> print(summary(a, digits = 3))
Call: earth(formula=O3~., data=ozone1, trace=4, degree=2)

                            coefficients
(Intercept)                 15.029
h(temp-58)                   0.313
h(234-ibt)                  -0.046
h(200-vis)                   0.022
h(doy-92)                   -0.024
h(92-doy)                   -0.134
h(wind-7) * h(200-vis)      -0.019
h(55-humidity) * h(temp-58) -0.022
h(temp-58) * h(dpg-54)      -0.019
h(temp-58) * h(54-dpg)       0.004
h(1108-ibh) * h(44-dpg)      0.000

Selected 11 of 21 terms, and 8 of 9 predictors 
Importance: temp, humidity, ibt, doy, dpg, ibh, vis, wind, vh-unused
Number of terms at each degree of interaction: 1 5 5
GCV 13.4    RSS 3762    GRSq 0.791    RSq 0.822
> print(evimp(a, trim=FALSE))
          col used nsubsets     gcv       rss  
temp        4    1       10 100.000 1 100.000 1
humidity    3    1        8  12.676 1  14.784 1
ibt         7    1        8  12.676 1  14.784 1
doy         9    1        7  11.265 1  12.926 1
dpg         6    1        5   6.754 1   7.838 1
ibh         5    1        4   9.577 0  10.455 0
vis         8    1        4   4.384 1   5.295 1
wind        2    1        1   0.741 1   0.977 1
vh-unused   1    0        0   0.000 1   0.000 1
> a <- update(a, nprune = 5, trace = 0)
> print(a, digits = 3)
Selected 5 of 21 terms, and 4 of 9 predictors 
Importance: temp, humidity, ibt, ibh-unused, doy, vh-unused, wind-unused, dpg-unused, vis-unused
Number of terms at each degree of interaction: 1 3 1
GCV 18.6    RSS 5730    GRSq 0.711    RSq 0.729
> print(earth:::get.nterms.per.degree(a))

0 1 2 
1 3 1 
> print(earth:::get.nused.preds.per.subset(a$dirs, a$which.terms))
[1] 0 1 1 1 1 1 1 2 2
> print(variable.names(a)[1:3])
[1] "vh"       "wind"     "humidity"
> print(deviance(a))
[1] 5730
> print(earth:::reorder.earth(a))
[1] 1 2 5 3 4
> print(predict(a, c(5710, 4, 28, 40, 2693, -25, 87, 250, 33)))
       O3
[1,] 6.63
> a <- earth(O3 ~ ., data = ozone1, degree = 1, minspan = 1)
> print(a, digits = 6)
Selected 12 of 20 terms, and 9 of 9 predictors 
Importance: temp, vh, humidity, dpg, doy, ibh, ibt, vis, wind
Number of terms at each degree of interaction: 1 11 (additive model)
GCV 14.6731    RSS 4190.68    GRSq 0.77207    RSq 0.801534
> print(summary(a, digits = 6, style = "pmax"))
Call: earth(formula=O3~., data=ozone1, degree=1, minspan=1)

O3 =
  12.5618
  -  0.0164945 * pmax(0,     5740 -       vh) 
  -   0.333539 * pmax(0,     wind -        3) 
  -   0.133342 * pmax(0,       54 - humidity) 
  +   0.318748 * pmax(0,     temp -       58) 
  - 0.00442377 * pmax(0,     1023 -      ibh) 
  -   0.100506 * pmax(0,      dpg -       12) 
  +  0.0372147 * pmax(0,      ibt -      120) 
  +  0.0446173 * pmax(0,       80 -      vis) 
  +  0.0419030 * pmax(0,      doy -       89) 
  -   0.114964 * pmax(0,       89 -      doy) 
  -  0.0833327 * pmax(0,      doy -      159) 

Selected 12 of 20 terms, and 9 of 9 predictors 
Importance: temp, vh, humidity, dpg, doy, ibh, ibt, vis, wind
Number of terms at each degree of interaction: 1 11 (additive model)
GCV 14.6731    RSS 4190.68    GRSq 0.77207    RSq 0.801534
> 
