

> # test.earth.R
> # The intention here is to check for porting problems by building
> # a model with tracing enabled, and to call each earth routine once.
> # For more comprehensive tests see earth\src\tests.
> # Not tested: mars.to.earth, plot.earth, plot.earth.models, plotmo
> library(earth)
Loading required package: leaps
> options(digits=3)
> data(ozone1)
> a <- earth(O3 ~ ., data = ozone1, degree = 2, trace = 4)
Forward pass: model matrix[330,9]   y[330,1]   minspan 1   endspan 15

         GRSq    RSq     DeltaRSq       RSS Pred PredName         Cut  Terms   Parents
1      0.0000 0.0000              2.112e+04                            1
2      0.6493 0.6599       0.6599   7181.92    4     temp          58  2   3   
4      0.6914 0.7099      0.05004   6125.24    5      ibh        1023  4   5   
6      0.7115 0.7372       0.0273   5548.77    9      doy          89  6   7   
8      0.7302 0.7620      0.02482   5024.59    3 humidity          54  8   9   2   
10     0.7546 0.7905      0.02847   4423.53    6      dpg          54  10  11  2   
12     0.7598 0.8016      0.01109   4189.41    8      vis         200  12  13  
14     0.7638 0.8114     0.009793   3982.63    2     wind           7  14  15  5   
16     0.7649 0.8186     0.007174   3831.14    1       vh        5550  16  17  
18     0.7666 0.8261     0.007497   3672.84    6      dpg          -4  18  19  13  
20     0.7676 0.8329     0.006843   3528.34    9      doy         151  20  21  16  

GRSq: 0.7676 RSq: 0.8329
Reached max number of terms 21
Forward pass complete: 21 terms

Subset size         GCV         GRSq      RSq  nPreds  Terms (index into bx)
          1     64.3756       0.0000   0.0000       0  1
          2     23.1254       0.6408   0.6462       1  1 2
          3     19.9058       0.6908   0.7001       2  1 2 4
          4     18.5797       0.7114   0.7244       3  1 2 4 9
          5     18.0541       0.7196   0.7363       4  1 2 4 9 10
          6      17.584       0.7269   0.7472       5  1 2 4 9 10 13
          7     16.7935       0.7391   0.7624       5  1 2 4 6 7 9 10
          8     15.8959       0.7531   0.7786       6  1 2 4 6 7 9 10 13
          9      15.183       0.7642   0.7920       6  1 2 9 13 16 18 19 20 21
         10     14.3957       0.7764   0.8059       8  1 2 4 6 7 9 10 13 14 16
         11     14.2025       0.7794   0.8116       8  1 2 4 6 7 9 10 11 13 14 16
         12     13.8257       0.7852   0.8196       8  1 2 4 6 7 9 10 13 14 16 18 19
         13     13.8336       0.7851   0.8225       8  1 2 4 6 9 10 13 14 16 18 19 20 21
chosen   14     13.7484       0.7864   0.8265       8  1 2 4 6 7 9 10 13 14 16 18 19 20 21
         15     13.8215       0.7853   0.8286       8  1 2 4 6 7 9 10 11 13 14 16 18 19 20 21
         16     13.9162       0.7838   0.8303       8  1 2 4 5 6 7 9 10 11 13 14 16 18 19 20 21
         17     14.0667       0.7815   0.8314       8  1 2 4 5 6 7 8 9 10 11 13 14 16 18 19 20 21
         18     14.2532       0.7786   0.8321       8  1 2 3 4 5 6 7 8 9 10 11 13 14 16 18 19 20 21
         19     14.4438       0.7756   0.8328       8  1 2 3 4 5 6 7 8 9 10 11 12 13 14 16 18 19 20 21
         20     14.6939       0.7717   0.8329       8  1 2 3 4 5 6 7 8 9 10 11 12 13 14 16 17 18 19 20 21
         21     14.9581       0.7676   0.8329       8  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21

Prune method "backward" ppenalty 3 nprune 21: selected 14 of 21 terms, and 8 of 9 predictors
GRSq: 0.7864 RSq: 0.8265 
> print(a, digits = 3)
Selected 14 of 21 terms, and 8 of 9 predictors
Number of terms at each degree of interaction: 1 6 7
GCV: 13.7         RSS: 3663         GRSq: 0.786      RSq: 0.827
> print(summary(a, digits = 3))
Call:
earth(formula = O3 ~ ., data = ozone1, degree = 2, trace = 4)

Expression:
  6.14 
  +   0.0361 * pmax(0,       vh -     5550) 
  +    0.356 * pmax(0,     temp -       58) 
  - 0.000526 * pmax(0,      ibh -     1023) 
  +   0.0378 * pmax(0,      200 -      vis) 
  -   0.0168 * pmax(0,      doy -       89) 
  -   0.0871 * pmax(0,       89 -      doy) 
  -    9e-05 * pmax(0,       vh -     5550) * pmax(0,      doy -      151) 
  - 0.000226 * pmax(0,       vh -     5550) * pmax(0,      151 -      doy) 
  -   0.0172 * pmax(0,     wind -        7) * pmax(0,     1023 -      ibh) 
  -   0.0168 * pmax(0,       54 - humidity) * pmax(0,     temp -       58) 
  -   0.0159 * pmax(0,     temp -       58) * pmax(0,      dpg -       54) 
  - 0.000493 * pmax(0,      dpg -       -4) * pmax(0,      200 -      vis) 
  - 0.000719 * pmax(0,       -4 -      dpg) * pmax(0,      200 -      vis) 

Number of cases: 330
Selected 14 of 21 terms, and 8 of 9 predictors
Number of terms at each degree of interaction: 1 6 7
GCV: 13.7         RSS: 3663         GRSq: 0.786      RSq: 0.827
> a <- update(a, nprune = 5, trace = 0)
> print(a, digits = 3)
Selected 5 of 21 terms, and 4 of 9 predictors
Number of terms at each degree of interaction: 1 2 2
GCV: 18.1         RSS: 5567         GRSq: 0.72       RSq: 0.736
> print(get.nterms.per.degree(a))

0 1 2 
1 2 2 
> print(get.nused.preds.per.subset(a$dirs, a$which.terms))
[1] 0 1 1 1 1 1 1 2 2
> print(case.names(a)[1:3])
[1] "1" "2" "3"
> print(variable.names(a)[1:3])
[1] "vh"       "wind"     "humidity"
> print(deviance(a))
[1] 5567
> print(reorder(a))
[1] 1 2 3 4 5
> print(predict(a, c(5710, 4, 28, 40, 2693, -25, 87, 250, 33)))
     [,1]
[1,] 7.51
> 
