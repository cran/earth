

> # test.earth.R
> # The intention here is to check for porting problems by building
> # a model with tracing enabled, and to call each earth routine once.
> # For more comprehensive tests see earth\src\tests.
> # Not tested: mars.to.earth, plot.earth, plot.earth.models, plotmo
> library(earth)
Loading required package: leaps
> options(digits=3)
> data(ozone1)
> a <- earth(O3 ~ ., data = ozone1, degree = 2, trace = 4)
Call: earth.default(x=x,y=y,trace=4,degree=2)

Predictors 1=vh 2=wind 3=humidity 4=temp 5=ibh 6=dpg 7=ibt 8=vis 9=doy 

Forward pass: model matrix[330,9]   y[330,1]   minspan 8   endspan 15

         GRSq    RSq     DeltaRSq       RSS Pred PredName         Cut  Terms   Parents
1      0.0000 0.0000              2.112e+04                            1
2      0.6493 0.6599       0.6599   7181.92    4     temp          58  2   3   
4      0.6903 0.7088      0.04898   6147.78    5      ibh        1108  4   5   
6      0.7102 0.7361      0.02722   5573.05    9      doy          92  6   7   
8      0.7295 0.7614      0.02532   5038.41    3 humidity          55  8   9   2   
10     0.7546 0.7904      0.02906    4424.8    6      dpg          54  10  11  2   
12     0.7597 0.8015      0.01109   4190.65    8      vis         200  12  13  
14     0.7632 0.8109     0.009396   3992.24    2     wind           7  14  15  13  
16     0.7640 0.8179      0.00697   3845.07    6      dpg          44  16  17  5   
18     0.7685 0.8275     0.009595   3642.46    7      ibt         234  18  19  
20     0.7662 0.8318     0.004351   3550.59    9      doy         159  20  21  2   

GRSq: 0.7662 RSq: 0.8318
Reached max number of terms 21
Forward pass complete: 21 terms

Subset size         GCV         GRSq      RSq  nPreds  Terms (index into bx)
          1     64.3756       0.0000   0.0000       0  1
          2     23.1254       0.6408   0.6462       1  1 2
          3     19.8917       0.6910   0.7003       2  1 2 4
          4     19.1727       0.7022   0.7156       3  1 2 9 19
          5     18.5807       0.7114   0.7286       4  1 2 6 9 19
          6     16.8746       0.7379   0.7574       4  1 2 6 7 9 19
          7     15.6677       0.7566   0.7783       5  1 2 6 7 9 11 19
          8     15.0794       0.7658   0.7900       6  1 2 6 7 9 11 13 19
          9     14.3402       0.7772   0.8035       7  1 2 6 7 9 11 13 17 19
         10     13.8116       0.7855   0.8138       7  1 2 6 7 9 10 11 13 17 19
chosen   11     13.4342       0.7913   0.8218       8  1 2 6 7 9 10 11 13 14 17 19
         12     13.5372       0.7897   0.8234       8  1 2 6 7 9 10 11 13 14 17 19 20
         13     13.5644       0.7893   0.8260       8  1 2 6 7 9 10 11 13 14 17 19 20 21
         14     13.7185       0.7869   0.8269       8  1 2 5 6 7 9 10 11 13 14 17 19 20 21
         15     13.8221       0.7853   0.8285       8  1 2 5 6 7 9 10 11 13 14 16 17 19 20 21
         16     13.9597       0.7832   0.8298       8  1 2 5 6 7 9 10 11 13 14 15 16 17 19 20 21
         17     14.1209       0.7806   0.8307       8  1 2 5 6 7 8 9 10 11 13 14 15 16 17 19 20 21
         18     14.3315       0.7774   0.8312       8  1 2 4 5 6 7 8 9 10 11 13 14 15 16 17 19 20 21
         19     14.5533       0.7739   0.8315       8  1 2 3 4 5 6 7 8 9 10 11 13 14 15 16 17 19 20 21
         20     14.7946       0.7702   0.8318       8  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 19 20 21
         21     15.0524       0.7662   0.8318       8  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21

Prune method "backward" penalty 3 nprune 21: selected 11 of 21 terms, and 8 of 9 predictors
GRSq: 0.7913 RSq: 0.8218 
> print(a, digits = 3)
Selected 11 of 21 terms, and 8 of 9 predictors
Number of terms at each degree of interaction: 1 5 5
GCV: 13.4         RSS: 3762         GRSq: 0.791      RSq: 0.822
> print(summary(a, digits = 3))
Call:
earth(formula = O3 ~ ., data = ozone1, degree = 2, trace = 4)

Expression:
  15 
  +    0.313 * pmax(0,     temp -       58) 
  -    0.046 * pmax(0,      234 -      ibt) 
  +   0.0221 * pmax(0,      200 -      vis) 
  -   0.0237 * pmax(0,      doy -       92) 
  -    0.134 * pmax(0,       92 -      doy) 
  -   0.0186 * pmax(0,     wind -        7) * pmax(0,      200 -      vis) 
  -   0.0219 * pmax(0,       55 - humidity) * pmax(0,     temp -       58) 
  -   0.0189 * pmax(0,     temp -       58) * pmax(0,      dpg -       54) 
  +  0.00416 * pmax(0,     temp -       58) * pmax(0,       54 -      dpg) 
  - 7.74e-05 * pmax(0,     1108 -      ibh) * pmax(0,       44 -      dpg) 

Number of cases: 330
Selected 11 of 21 terms, and 8 of 9 predictors
Number of terms at each degree of interaction: 1 5 5
GCV: 13.4         RSS: 3762         GRSq: 0.791      RSq: 0.822
> a <- update(a, nprune = 5, trace = 0)
> print(a, digits = 3)
Selected 5 of 21 terms, and 4 of 9 predictors
Number of terms at each degree of interaction: 1 3 1
GCV: 18.6         RSS: 5730         GRSq: 0.711      RSq: 0.729
> print(earth:::get.nterms.per.degree(a))

0 1 2 
1 3 1 
> print(earth:::get.nused.preds.per.subset(a$dirs, a$which.terms))
[1] 0 1 1 1 1 1 1 2 2
> print(case.names(a)[1:3])
[1] "1" "2" "3"
> print(variable.names(a)[1:3])
[1] "vh"       "wind"     "humidity"
> print(deviance(a))
[1] 5730
> print(earth:::reorder.earth(a))
[1] 1 2 5 3 4
> print(predict(a, c(5710, 4, 28, 40, 2693, -25, 87, 250, 33)))
     [,1]
[1,] 6.63
> a <- earth(O3 ~ ., data = ozone1, degree = 1, minspan = 1)
> print(a, digits = 6)
Selected 12 of 20 terms, and 9 of 9 predictors
Number of terms at each degree of interaction: 1 11 (additive model)
GCV: 14.6731         RSS: 4190.68         GRSq: 0.77207       RSq: 0.801534
> print(summary(a, digits = 6))
Call:
earth(formula = O3 ~ ., data = ozone1, degree = 1, minspan = 1)

Expression:
  12.5618 
  -  0.0164945 * pmax(0,     5740 -       vh) 
  -   0.333539 * pmax(0,     wind -        3) 
  -   0.133342 * pmax(0,       54 - humidity) 
  +   0.318748 * pmax(0,     temp -       58) 
  - 0.00442377 * pmax(0,     1023 -      ibh) 
  -   0.100506 * pmax(0,      dpg -       12) 
  +  0.0372147 * pmax(0,      ibt -      120) 
  +  0.0446173 * pmax(0,       80 -      vis) 
  +  0.0419030 * pmax(0,      doy -       89) 
  -   0.114964 * pmax(0,       89 -      doy) 
  -  0.0833327 * pmax(0,      doy -      159) 

Number of cases: 330
Selected 12 of 20 terms, and 9 of 9 predictors
Number of terms at each degree of interaction: 1 11 (additive model)
GCV: 14.6731         RSS: 4190.68         GRSq: 0.77207       RSq: 0.801534
> 
